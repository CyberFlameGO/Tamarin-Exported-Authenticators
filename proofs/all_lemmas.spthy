//Proven with the following Tamarin version:
//tamarin-prover 1.3.1, (C) David Basin, Cas Cremers, Jannik Dreier, Simon Meier, Ralf Sasse, Benedikt Schmidt, ETH Zurich 2010-2017
//Git revision: 120c7e706f3e1d4646b233faf2bc9936834ed9d3, branch: develop

theory ExportedAuthenticators_lemmas begin

// Function signature and definition of the equational theory E

functions: Expand/3, Exporter/3, Extract/2, adec/2, aenc/2, fst/1,
           h/1, hmac/1, mac/1, pair/2, pk/1, sign/2, snd/1, true/0, verify/3
equations:
    adec(aenc(x.1, pk(x.2)), x.2) = x.1,
    fst(<x.1, x.2>) = x.1,
    snd(<x.1, x.2>) = x.2,
    verify(sign(x.1, x.2), x.1, pk(x.2)) = true

/* looping facts with injective instances: State/6 */

section{* TLS Exported Authenticators*}

restriction Eq_check_succeed:
  "∀ x y #i. (Eq( x, y ) @ #i) ⇒ (x = y)"
  // safety formula

restriction Neq_check_succeed:
  "∀ x y #i. (Neq( x, y ) @ #i) ⇒ (¬(x = y))"
  // safety formula

restriction is_none:
  "∀ cert status #i.
    (Check_is_none( cert, status ) @ #i) ⇒
    (((cert = 'none') ∧ (status = 'uni')) ∨
     ((¬(cert = 'none')) ∧ (status = 'bi')))"
  // safety formula

rule (modulo E) Reveal_ltk:
   [ !Ltk( A, ltk ) ] --[ RevLtk( ltk, A ) ]-> [ Out( ltk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Reveal_ms:
   [ !TLS_Channel( ms, TLS_transcript, status, C, nc, S, ns ) ]
  --[ Revms( ms, C, S ), Revms( ms, S, C ) ]->
   [ Out( <ms, TLS_transcript, status, nc, ns> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Adv_Send_TLS_owner:
   [
   In( <ms, m> ),
   !TLS_Channel( ms, TLS_transcript, auth_status, $C, cid, $S, sid )
   ]
  --[ A_Send( cid ) ]->
   [ TLS_Send( '0', cid, $C, $S, m ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Adv_Send_TLS_target:
   [
   In( <ms, m> ),
   !TLS_Channel( ms, TLS_transcript, auth_status, $C, cid, $S, sid )
   ]
  --[ A_Send( sid ) ]->
   [ TLS_Send( '0', sid, $S, $C, m ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Adv_Recv_TLS_owner:
   [
   TLS_Send( msg_id, nc, $C, $S, msg ),
   !TLS_Channel( ms, TLS_transcript, state, $C, nc, $S, ns ), In( ms )
   ]
  --[ A_Recv( nc ), Neq( msg_id, '0' ) ]->
   [ Out( <$C, $S, msg> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Adv_Recv_TLS_target:
   [
   TLS_Send( msg_id, ns, $S, $C, msg ),
   !TLS_Channel( ms, TLS_transcript, state, $C, nc, $S, ns ), In( ms )
   ]
  --[ A_Recv( ns ), Neq( msg_id, '0' ) ]->
   [ Out( <$S, $C, msg> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Register_pk:
   [ Fr( ~ltk ) ]
  --[ Clean( ~ltk ) ]->
   [ !Ltk( $A, ~ltk ), !Pk( $A, pk(~ltk) ), DelegateLtk( $TP, ~ltk ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Get_pk:
   [ !Pk( A, pubkey ) ] --[ RevPk( pubkey ) ]-> [ Out( pubkey ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_TLS_channel:
   [
   Fr( ms ), Fr( TLS_transcript ),
   Create_TLS_Channel4( $C, nc, cert, $S, ns, pk(ltkS), status )
   ]
  --[ SessionKey( ms, TLS_transcript ), Check_is_none( cert, status )
  ]->
   [
   !TLS_Channel( ms, TLS_transcript, status, $C, nc, $S, ns ),
   !Exporters( ms, 'server', ns,
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_clientauthenticatorhandshakecontext', 'empty'>,
                             '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 'empty'>,
                             '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_clientauthenticatorfinishedkey', 'empty'>, '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_serverauthenticatorfinishedkey', 'empty'>, '32'),
                      <'32', 'exporter', h('empty')>, '32')
   ),
   !Exporters( ms, 'client', nc,
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_clientauthenticatorhandshakecontext', 'empty'>,
                             '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 'empty'>,
                             '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_clientauthenticatorfinishedkey', 'empty'>, '32'),
                      <'32', 'exporter', h('empty')>, '32'),
               Expand(Expand(Expand(ms,
                                    <'32', 'TLS13exportermastersecret', h(TLS_transcript)>, '32'),
                             <'32', 'EXPORTER_serverauthenticatorfinishedkey', 'empty'>, '32'),
                      <'32', 'exporter', h('empty')>, '32')
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Send_TLS_Channel_owner:
   [
   TLS_Send( msg_id, nc, $C, $S, msg ),
   !TLS_Channel( ms, TLS_transcript, state, $C, nc, $S, ns )
   ]
  -->
   [ TLS_Recv( ns, $C, $S, msg ) ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) Send_TLS_Channel_target:
   [
   TLS_Send( msg_id, ns, $S, $C, msg ),
   !TLS_Channel( ms, TLS_transcript, state, $C, nc, $S, ns )
   ]
  -->
   [ TLS_Recv( nc, $S, $C, msg ) ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_0:
   [ Fr( ~cid ) ]
  --[ PreStart( ~cid, $C, $S, 'client' ), C0( ~cid ), Neq( $C, $S )
  ]->
   [
   State( ~cid, 'C0', $C, $S, 'client', 'none' ),
   Create_TLS_Channel( $C, ~cid, $S )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) C_1_uni:
   [
   Create_TLS_Channel2( $C, ~cid, $S, sid, pk(ltkS) ),
   State( ~cid, 'C0', $C, $S, 'client', 'none' ), !Pk( $S, pk(ltkS) )
   ]
  --[ C1( ~cid ), Start( ~cid, $C, $S, 'client' ) ]->
   [
   State( ~cid, 'C1', $C, $S, 'client', 'auth' ),
   Create_TLS_Channel3( $C, ~cid, 'none', $S, sid, pk(ltkS) )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) C_1_bi:
   [
   Create_TLS_Channel2( $C, ~cid, $S, sid, pk(ltkS) ),
   State( ~cid, 'C0', $C, $S, 'client', 'none' ), !Pk( $S, pk(ltkS) ),
   !Ltk( $C, ltkC )
   ]
  --[ C1( ~cid ), Start( ~cid, $C, $S, 'client' ) ]->
   [
   State( ~cid, 'C1', $C, $S, 'client', 'auth' ),
   Create_TLS_Channel3( $C, ~cid, pk(ltkC), $S, sid, pk(ltkS) )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) C_Request:
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   !TLS_Channel( ms, TLS_transcript, channel_status, $C, ~cid, $S, sid
   ),
   Fr( ~certificate_request_context ), Fr( ~request_id ),
   Fr( ~msg_id )
   ]
  --[
  C_Req( ~cid, ~certificate_request_context ),
  Instance( ~cid, $C, $S, 'client' ),
  Requested( ~cid, $C, 'client', ~certificate_request_context ),
  TLS_Sent( ms,
            <'13', ~certificate_request_context, $certificate_extensions>
  )
  ]->
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   TLS_Send( ~msg_id, ~cid, $C, $S,
             <'13', ~certificate_request_context, $certificate_extensions>
   ),
   PendingReqI( ~request_id, ~cid, 'client',
                <'13', ~certificate_request_context, $certificate_extensions>
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_RecvReq:
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   TLS_Recv( ~cid, $S, $C,
             <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
   Fr( ~request_id )
   ]
  --[
  C_RecvReq( ~cid ),
  RecvReq( $C, ms, 'client', certificate_request_context ),
  Instance( ~cid, $C, $S, 'client' ),
  TLS_Recvd( ms,
             <'13', certificate_request_context, $certificate_extensions>
  )
  ]->
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   PendingReqR( ~request_id, ~cid, 'client',
                <'13', certificate_request_context, $certificate_extensions>
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_Send:
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   PendingReqR( ~request_id, ~cid, 'client',
                <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
   !Ltk( $A, ltkA ), DelegateLtk( $C, ltkA ), Fr( ~msg_id )
   ]
  --[
  C_Send( ~cid ), Owns( $C, ms, 'client', <$A, ltkA> ),
  Instance( ~cid, $C, $S, 'client' ),
  Fulfil( ~cid, $C, 'client', certificate_request_context,
          <$A, pk(ltkA)>
  ),
  TLS_Sent( ms,
            <<'11', certificate_request_context, pk(ltkA)>, 
             <'15', 
              sign(<'ExportedAuthenticator', 
                    h(<hccc, 
                       <'13', certificate_request_context, $certificate_extensions>, 
                       pk(ltkA)>)
                   >,
                   ltkA)
             >, 
             '20', 
             hmac(<fmc, hccc, 
                   <'13', certificate_request_context, $certificate_extensions>, 
                   <'11', certificate_request_context, pk(ltkA)>, '15', 
                   sign(<'ExportedAuthenticator', 
                         h(<hccc, 
                            <'13', certificate_request_context, $certificate_extensions>, 
                            pk(ltkA)>)
                        >,
                        ltkA)
                  >)
            >
  ),
  Signed( sign(<'ExportedAuthenticator', 
                h(<hccc, 
                   <'13', certificate_request_context, $certificate_extensions>, 
                   pk(ltkA)>)
               >,
               ltkA)
  )
  ]->
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   TLS_Send( ~msg_id, ~cid, $C, $S,
             <<'11', certificate_request_context, pk(ltkA)>, 
              <'15', 
               sign(<'ExportedAuthenticator', 
                     h(<hccc, 
                        <'13', certificate_request_context, $certificate_extensions>, 
                        pk(ltkA)>)
                    >,
                    ltkA)
              >, 
              '20', 
              hmac(<fmc, hccc, 
                    <'13', certificate_request_context, $certificate_extensions>, 
                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                    sign(<'ExportedAuthenticator', 
                          h(<hccc, 
                             <'13', certificate_request_context, $certificate_extensions>, 
                             pk(ltkA)>)
                         >,
                         ltkA)
                   >)
             >
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_Recv:
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   TLS_Recv( ~cid, $S, $C,
             <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
              '20', verify_data>
   ),
   PendingReqI( ~request_id, ~cid, 'client',
                <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
   !Pk( $A, pk(ltkA) )
   ]
  --[
  C_Recv( ~cid ),
  Eq( verify(signature,
             <'ExportedAuthenticator', 
              h(<hccs, 
                 <'13', certificate_request_context, $certificate_extensions>, 
                 pk(ltkA)>)
             >,
             pk(ltkA)),
      true
  ),
  Eq( verify_data,
      hmac(<fms, hccs, 
            <'13', certificate_request_context, $certificate_extensions>, 
            <'11', certificate_request_context, pk(ltkA)>, '15', signature>)
  ),
  Recv( $C, $S, ms, 'client', <$A, pk(ltkA)> ),
  Fulfilled( ~cid, $C, 'client', certificate_request_context,
             <$A, pk(ltkA)>
  ),
  Instance( ~cid, $C, $S, 'client' ),
  TLS_Recvd( ms,
             <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
              '20', verify_data>
  )
  ]->
   [ State( ~cid, 'C1', $C, $S, 'client', auth_status ) ]

  // loop breaker: [0]
  /*
  rule (modulo AC) C_Recv:
     [
     State( ~cid, 'C1', $C, $S, 'client', auth_status ),
     TLS_Recv( ~cid, $S, $C,
               <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
                '20', verify_data>
     ),
     PendingReqI( ~request_id, ~cid, 'client',
                  <'13', certificate_request_context, $certificate_extensions>
     ),
     !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
     !Pk( $A, pk(ltkA) )
     ]
    --[
    C_Recv( ~cid ), Eq( z, true ),
    Eq( verify_data,
        hmac(<fms, hccs, 
              <'13', certificate_request_context, $certificate_extensions>, 
              <'11', certificate_request_context, pk(ltkA)>, '15', signature>)
    ),
    Recv( $C, $S, ms, 'client', <$A, pk(ltkA)> ),
    Fulfilled( ~cid, $C, 'client', certificate_request_context,
               <$A, pk(ltkA)>
    ),
    Instance( ~cid, $C, $S, 'client' ),
    TLS_Recvd( ms,
               <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
                '20', verify_data>
    )
    ]->
     [ State( ~cid, 'C1', $C, $S, 'client', auth_status ) ]
    variants (modulo AC)
    1. $certificate_extensions
             = $certificate_extensions.34
       certificate_request_context
             = certificate_request_context.38
       hccs  = hccs.42
       ltkA  = ltkA.43
       signature
             = sign(<'ExportedAuthenticator', 
                     h(<hccs.42, 
                        <'13', certificate_request_context.38, $certificate_extensions.34
                        >, 
                        pk(ltkA.43)>)
                    >,
                    ltkA.43)
       z     = true
    
    2. $certificate_extensions
             = $certificate_extensions.36
       certificate_request_context
             = certificate_request_context.40
       hccs  = hccs.44
       ltkA  = ltkA.45
       signature
             = signature.47
       z     = verify(signature.47,
                      <'ExportedAuthenticator', 
                       h(<hccs.44, 
                          <'13', certificate_request_context.40, $certificate_extensions.36
                          >, 
                          pk(ltkA.45)>)
                      >,
                      pk(ltkA.45))
    // loop breaker: [0]
  */

rule (modulo E) C_Recv_Spontaneous:
   [
   State( ~cid, 'C1', $C, $S, 'client', auth_status ),
   TLS_Recv( ~cid, $S, $C,
             <<'11', pk(ltkA)>, <'15', signature>, '20', verify_data>
   ),
   !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
   !Pk( $A, pk(ltkA) )
   ]
  --[
  C_Recv( ~cid ),
  Eq( verify(signature,
             <'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, pk(ltkA)),
      true
  ),
  Eq( verify_data,
      hmac(<fms, hccs, <'11', pk(ltkA)>, '15', signature>)
  ),
  Recv( $C, $S, ms, 'client', <$A, pk(ltkA)> ),
  Instance( ~cid, $C, $S, 'client' ),
  TLS_Recvd( ms,
             <<'11', pk(ltkA)>, <'15', signature>, '20', verify_data>
  )
  ]->
   [ State( ~cid, 'C1', $C, $S, 'client', auth_status ) ]

  // loop breaker: [0]
  /*
  rule (modulo AC) C_Recv_Spontaneous:
     [
     State( ~cid, 'C1', $C, $S, 'client', auth_status ),
     TLS_Recv( ~cid, $S, $C,
               <<'11', pk(ltkA)>, <'15', signature>, '20', verify_data>
     ),
     !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms ),
     !Pk( $A, pk(ltkA) )
     ]
    --[
    C_Recv( ~cid ), Eq( z, true ),
    Eq( verify_data,
        hmac(<fms, hccs, <'11', pk(ltkA)>, '15', signature>)
    ),
    Recv( $C, $S, ms, 'client', <$A, pk(ltkA)> ),
    Instance( ~cid, $C, $S, 'client' ),
    TLS_Recvd( ms,
               <<'11', pk(ltkA)>, <'15', signature>, '20', verify_data>
    )
    ]->
     [ State( ~cid, 'C1', $C, $S, 'client', auth_status ) ]
    variants (modulo AC)
    1. hccs  = hccs.22
       ltkA  = ltkA.23
       signature
             = sign(<'ExportedAuthenticator', h(<hccs.22, pk(ltkA.23)>)>,
                    ltkA.23)
       z     = true
    
    2. hccs  = hccs.24
       ltkA  = ltkA.25
       signature
             = signature.27
       z     = verify(signature.27,
                      <'ExportedAuthenticator', h(<hccs.24, pk(ltkA.25)>)>, pk(ltkA.25))
    // loop breaker: [0]
  */

rule (modulo E) S_0:
   [ Create_TLS_Channel( $C, cid, $S ), Fr( ~sid ), !Ltk( $S, ltkS ) ]
  --[ PreStart( ~sid, $S, $C, 'server' ), S0( ~sid ) ]->
   [
   Create_TLS_Channel2( $C, cid, $S, ~sid, pk(ltkS) ),
   State( ~sid, 'S0', $S, $C, 'server', 'none' )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_1_uni:
   [
   Create_TLS_Channel3( $C, cid, 'none', $S, ~sid, pk(ltkS) ),
   State( ~sid, 'S0', $S, $C, 'server', 'none' )
   ]
  --[ Start( ~sid, $S, $C, 'server' ), S1( ~sid ) ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', 'none' ),
   Create_TLS_Channel4( $C, cid, 'none', $S, ~sid, pk(ltkS), 'uni' )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_1_bi:
   [
   Create_TLS_Channel3( $C, cid, pk(ltkC), $S, ~sid, pk(ltkS) ),
   State( ~sid, 'S0', $S, $C, 'server', 'none' ), !Pk( $C, pk(ltkC) )
   ]
  --[ Start( ~sid, $S, $C, 'server' ), S1( ~sid ) ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', 'auth' ),
   Create_TLS_Channel4( $C, cid, pk(ltkC), $S, ~sid, pk(ltkS), 'bi' )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_Request:
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   !TLS_Channel( ms, TLS_transcript, channel_status, $C, cid, $S, ~sid
   ),
   Fr( ~certificate_request_context ), Fr( ~request_id ),
   Fr( ~msg_id )
   ]
  --[
  S_Req( ~sid, ~certificate_request_context ),
  Instance( ~sid, $S, $C, 'server' ),
  Requested( ~sid, $S, 'server', ~certificate_request_context ),
  TLS_Sent( ms,
            <'13', ~certificate_request_context, $certificate_extensions>
  )
  ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   TLS_Send( ~msg_id, ~sid, $S, $C,
             <'13', ~certificate_request_context, $certificate_extensions>
   ),
   PendingReqI( ~request_id, ~sid, 'server',
                <'13', ~certificate_request_context, $certificate_extensions>
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) S_RecvReq:
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   TLS_Recv( ~sid, $C, $S,
             <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms ),
   Fr( ~request_id )
   ]
  --[
  S_RecvReq( ~sid ),
  RecvReq( $S, ms, 'server', certificate_request_context ),
  Instance( ~sid, $S, $C, 'server' ),
  TLS_Recvd( ms,
             <'13', certificate_request_context, $certificate_extensions>
  )
  ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   PendingReqR( ~request_id, ~sid, 'server',
                <'13', certificate_request_context, $certificate_extensions>
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) S_Send:
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   PendingReqR( ~request_id, ~sid, 'server',
                <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms ),
   !Ltk( $A, ltkA ), DelegateLtk( $S, ltkA ), Fr( ~msg_id )
   ]
  --[
  S_Send( ~sid ), Owns( $S, ms, 'server', <$A, ltkA> ),
  Instance( ~sid, $S, $C, 'server' ),
  Fulfil( ~sid, $S, 'server', certificate_request_context, <$A, ltkA>
  ),
  TLS_Sent( ms,
            <<'11', certificate_request_context, pk(ltkA)>, 
             <'15', 
              sign(<'ExportedAuthenticator', 
                    h(<hccs, 
                       <'13', certificate_request_context, $certificate_extensions>, 
                       pk(ltkA)>)
                   >,
                   ltkA)
             >, 
             '20', 
             hmac(<fms, hccs, 
                   <'13', certificate_request_context, $certificate_extensions>, 
                   <'11', certificate_request_context, pk(ltkA)>, '15', 
                   sign(<'ExportedAuthenticator', 
                         h(<hccs, 
                            <'13', certificate_request_context, $certificate_extensions>, 
                            pk(ltkA)>)
                        >,
                        ltkA)
                  >)
            >
  ),
  Signed( sign(<'ExportedAuthenticator', 
                h(<hccs, 
                   <'13', certificate_request_context, $certificate_extensions>, 
                   pk(ltkA)>)
               >,
               ltkA)
  )
  ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   TLS_Send( ~msg_id, ~sid, $S, $C,
             <<'11', certificate_request_context, pk(ltkA)>, 
              <'15', 
               sign(<'ExportedAuthenticator', 
                     h(<hccs, 
                        <'13', certificate_request_context, $certificate_extensions>, 
                        pk(ltkA)>)
                    >,
                    ltkA)
              >, 
              '20', 
              hmac(<fms, hccs, 
                    <'13', certificate_request_context, $certificate_extensions>, 
                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                    sign(<'ExportedAuthenticator', 
                          h(<hccs, 
                             <'13', certificate_request_context, $certificate_extensions>, 
                             pk(ltkA)>)
                         >,
                         ltkA)
                   >)
             >
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) S_Recv:
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   TLS_Recv( ~sid, $C, $S,
             <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
              '20', verify_data>
   ),
   PendingReqI( ~request_id, ~sid, 'server',
                <'13', certificate_request_context, $certificate_extensions>
   ),
   !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms ),
   !Pk( $A, pk(ltkA) )
   ]
  --[
  S_Recv( ~sid ),
  Eq( verify(signature,
             <'ExportedAuthenticator', 
              h(<hccc, 
                 <'13', certificate_request_context, $certificate_extensions>, 
                 pk(ltkA)>)
             >,
             pk(ltkA)),
      true
  ),
  Eq( verify_data,
      hmac(<fmc, hccc, 
            <'13', certificate_request_context, $certificate_extensions>, 
            <'11', certificate_request_context, pk(ltkA)>, '15', signature>)
  ),
  Recv( $S, $C, ms, 'server', <$A, pk(ltkA)> ),
  Fulfilled( ~sid, $S, 'server', certificate_request_context,
             <$A, pk(ltkA)>
  ),
  Instance( ~sid, $S, $C, 'server' ),
  TLS_Recvd( ms,
             <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
              '20', verify_data>
  )
  ]->
   [ State( ~sid, 'S1', $S, $C, 'server', auth_status ) ]

  // loop breaker: [0]
  /*
  rule (modulo AC) S_Recv:
     [
     State( ~sid, 'S1', $S, $C, 'server', auth_status ),
     TLS_Recv( ~sid, $C, $S,
               <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
                '20', verify_data>
     ),
     PendingReqI( ~request_id, ~sid, 'server',
                  <'13', certificate_request_context, $certificate_extensions>
     ),
     !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms ),
     !Pk( $A, pk(ltkA) )
     ]
    --[
    S_Recv( ~sid ), Eq( z, true ),
    Eq( verify_data,
        hmac(<fmc, hccc, 
              <'13', certificate_request_context, $certificate_extensions>, 
              <'11', certificate_request_context, pk(ltkA)>, '15', signature>)
    ),
    Recv( $S, $C, ms, 'server', <$A, pk(ltkA)> ),
    Fulfilled( ~sid, $S, 'server', certificate_request_context,
               <$A, pk(ltkA)>
    ),
    Instance( ~sid, $S, $C, 'server' ),
    TLS_Recvd( ms,
               <<'11', certificate_request_context, pk(ltkA)>, <'15', signature>, 
                '20', verify_data>
    )
    ]->
     [ State( ~sid, 'S1', $S, $C, 'server', auth_status ) ]
    variants (modulo AC)
    1. $certificate_extensions
             = $certificate_extensions.34
       certificate_request_context
             = certificate_request_context.38
       hccc  = hccc.41
       ltkA  = ltkA.43
       signature
             = sign(<'ExportedAuthenticator', 
                     h(<hccc.41, 
                        <'13', certificate_request_context.38, $certificate_extensions.34
                        >, 
                        pk(ltkA.43)>)
                    >,
                    ltkA.43)
       z     = true
    
    2. $certificate_extensions
             = $certificate_extensions.36
       certificate_request_context
             = certificate_request_context.40
       hccc  = hccc.43
       ltkA  = ltkA.45
       signature
             = signature.47
       z     = verify(signature.47,
                      <'ExportedAuthenticator', 
                       h(<hccc.43, 
                          <'13', certificate_request_context.40, $certificate_extensions.36
                          >, 
                          pk(ltkA.45)>)
                      >,
                      pk(ltkA.45))
    // loop breaker: [0]
  */

rule (modulo E) S_Send_Spontaneous:
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms ),
   !Ltk( $A, ltkA ), DelegateLtk( $S, ltkA ), Fr( ~msg_id )
   ]
  --[
  S_Send( ~sid ), Owns( $S, ms, 'server', <$A, ltkA> ),
  Instance( ~sid, $S, $C, 'server' ),
  TLS_Sent( ms,
            <<'11', pk(ltkA)>, 
             <'15', sign(<'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, ltkA)
             >, 
             '20', 
             hmac(<fms, hccs, <'11', pk(ltkA)>, '15', 
                   sign(<'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, ltkA)>)
            >
  ),
  Signed( sign(<'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, ltkA)
  )
  ]->
   [
   State( ~sid, 'S1', $S, $C, 'server', auth_status ),
   TLS_Send( ~msg_id, ~sid, $S, $C,
             <<'11', pk(ltkA)>, 
              <'15', sign(<'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, ltkA)
              >, 
              '20', 
              hmac(<fms, hccs, <'11', pk(ltkA)>, '15', 
                    sign(<'ExportedAuthenticator', h(<hccs, pk(ltkA)>)>, ltkA)>)
             >
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

lemma uniq_Start [reuse]:
  all-traces
  "∀ tid actor1 actor2 peer1 peer2 role1 role2 #i #j.
    ((Start( tid, actor1, peer1, role1 ) @ #i) ∧
     (Start( tid, actor2, peer2, role2 ) @ #j)) ⇒
    ((((#i = #j) ∧ (actor1 = actor2)) ∧ (peer1 = peer2)) ∧
     (role1 = role2))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor1 actor2 peer1 peer2 role1 role2 #i #j.
  (Start( tid, actor1, peer1, role1 ) @ #i) ∧
  (Start( tid, actor2, peer2, role2 ) @ #j)
 ∧
  ((¬(#i = #j)) ∨
   (¬(actor1 = actor2)) ∨
   (¬(peer1 = peer2)) ∨
   (¬(role1 = role2)))"
*/
simplify
solve( Start( tid, actor1, peer1, role1 ) @ #i )
  case C_1_bi
  solve( Create_TLS_Channel2( $C, ~cid, $S, sid, pk(ltkS) ) ▶₀ #i )
    case S_0
    solve( Start( ~cid, actor2, peer2, role2 ) @ #j )
      case C_1_bi
      solve( Create_TLS_Channel2( $C.1, ~cid, $S.1, sid.1, pk(ltkS)
             ) ▶₀ #j )
        case S_0
        by contradiction /* from formulas */
      qed
    next
      case C_1_uni
      by solve( Create_TLS_Channel2( $C.1, ~cid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_bi
      by solve( Create_TLS_Channel3( $C.1, cid.1, pk(ltkC.1), $S.1, ~cid,
                                     pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_uni
      by solve( Create_TLS_Channel3( $C.1, cid.1, 'none', $S.1, ~cid,
                                     pk(ltkS)
                ) ▶₀ #j )
    qed
  qed
next
  case C_1_uni
  solve( Create_TLS_Channel2( $C, ~cid, $S, sid, pk(ltkS) ) ▶₀ #i )
    case S_0
    solve( Start( ~cid, actor2, peer2, role2 ) @ #j )
      case C_1_bi
      by solve( Create_TLS_Channel2( $C.1, ~cid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case C_1_uni
      solve( Create_TLS_Channel2( $C.1, ~cid, $S.1, sid.1, pk(ltkS)
             ) ▶₀ #j )
        case S_0
        by contradiction /* from formulas */
      qed
    next
      case S_1_bi
      by solve( Create_TLS_Channel3( $C.1, cid.1, pk(ltkC), $S.1, ~cid,
                                     pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_uni
      by solve( Create_TLS_Channel3( $C.1, cid.1, 'none', $S.1, ~cid,
                                     pk(ltkS)
                ) ▶₀ #j )
    qed
  qed
next
  case S_1_bi
  solve( Create_TLS_Channel3( $C, cid, pk(ltkC), $S, ~sid, pk(ltkS)
         ) ▶₀ #i )
    case C_1_bi
    solve( Start( ~sid, actor2, peer2, role2 ) @ #j )
      case C_1_bi
      by solve( Create_TLS_Channel2( $C.1, ~sid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case C_1_uni
      by solve( Create_TLS_Channel2( $C.1, ~sid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_bi
      solve( Create_TLS_Channel3( $C.1, cid.1, pk(ltkC), $S.1, ~sid,
                                  pk(ltkS)
             ) ▶₀ #j )
        case C_1_bi
        by contradiction /* from formulas */
      qed
    next
      case S_1_uni
      by solve( Create_TLS_Channel3( $C.1, cid.1, 'none', $S.1, ~sid,
                                     pk(ltkS)
                ) ▶₀ #j )
    qed
  qed
next
  case S_1_uni
  solve( Create_TLS_Channel3( $C, cid, 'none', $S, ~sid, pk(ltkS)
         ) ▶₀ #i )
    case C_1_uni
    solve( Start( ~sid, actor2, peer2, role2 ) @ #j )
      case C_1_bi
      by solve( Create_TLS_Channel2( $C.1, ~sid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case C_1_uni
      by solve( Create_TLS_Channel2( $C.1, ~sid, $S.1, sid.1, pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_bi
      by solve( Create_TLS_Channel3( $C.1, cid.1, pk(ltkC), $S.1, ~sid,
                                     pk(ltkS)
                ) ▶₀ #j )
    next
      case S_1_uni
      solve( Create_TLS_Channel3( $C.1, cid.1, 'none', $S.1, ~sid,
                                  pk(ltkS)
             ) ▶₀ #j )
        case C_1_uni
        by contradiction /* from formulas */
      qed
    qed
  qed
qed

lemma pre_tid_invariant [reuse]:
  all-traces
  "∀ tid actor peer role #i.
    (Start( tid, actor, peer, role ) @ #i) ⇒
    (∃ #j. (PreStart( tid, actor, peer, role ) @ #j) ∧ (#j < #i))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor peer role #i.
  (Start( tid, actor, peer, role ) @ #i)
 ∧
  ∀ #j. (PreStart( tid, actor, peer, role ) @ #j) ⇒ ¬(#j < #i)"
*/
simplify
solve( Start( tid, actor, peer, role ) @ #i )
  case C_1_bi
  solve( State( ~cid, 'C0', $C, $S, 'client', 'none' ) ▶₁ #i )
    case C_0
    by contradiction /* from formulas */
  qed
next
  case C_1_uni
  solve( State( ~cid, 'C0', $C, $S, 'client', 'none' ) ▶₁ #i )
    case C_0
    by contradiction /* from formulas */
  qed
next
  case S_1_bi
  solve( State( ~sid, 'S0', $S, $C, 'server', 'none' ) ▶₁ #i )
    case S_0
    by contradiction /* from formulas */
  qed
next
  case S_1_uni
  solve( State( ~sid, 'S0', $S, $C, 'server', 'none' ) ▶₁ #i )
    case S_0
    by contradiction /* from formulas */
  qed
qed

lemma tid_invariant [use_induction, reuse]:
  all-traces
  "∀ tid actor peer role #i.
    (Instance( tid, actor, peer, role ) @ #i) ⇒
    (∃ #j. (Start( tid, actor, peer, role ) @ #j) ∧ (#j < #i))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor peer role #i.
  (Instance( tid, actor, peer, role ) @ #i)
 ∧
  ∀ #j. (Start( tid, actor, peer, role ) @ #j) ⇒ ¬(#j < #i)"
*/
induction
  case empty_trace
  by contradiction /* from formulas */
next
  case non_empty_trace
  simplify
  solve( (last(#i))  ∥
         (∃ #j.
           (Start( tid, actor, peer, role ) @ #j)
          ∧
           (¬(last(#j))) ∧ (#j < #i)) )
    case case_1
    solve( Instance( tid, actor, peer, role ) @ #i )
      case C_Recv
      solve( State( ~cid, 'C1', $C, $S, 'client', auth_status ) ▶₀ #i )
        case C_1_bi
        by contradiction /* from formulas */
      next
        case C_1_uni
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_case_2
        by contradiction /* from formulas */
      next
        case C_Request_case_1
        by contradiction /* from formulas */
      next
        case C_Request_case_2
        by contradiction /* from formulas */
      next
        case C_Send_case_1
        by contradiction /* from formulas */
      next
        case C_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case C_RecvReq
      solve( State( ~cid, 'C1', $C, $S, 'client', auth_status ) ▶₀ #i )
        case C_1_bi
        by contradiction /* from formulas */
      next
        case C_1_uni
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_case_2
        by contradiction /* from formulas */
      next
        case C_Request_case_1
        by contradiction /* from formulas */
      next
        case C_Request_case_2
        by contradiction /* from formulas */
      next
        case C_Send_case_1
        by contradiction /* from formulas */
      next
        case C_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case C_Recv_Spontaneous
      solve( State( ~cid, 'C1', $C, $S, 'client', auth_status ) ▶₀ #i )
        case C_1_bi
        by contradiction /* from formulas */
      next
        case C_1_uni
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_case_2
        by contradiction /* from formulas */
      next
        case C_Request_case_1
        by contradiction /* from formulas */
      next
        case C_Request_case_2
        by contradiction /* from formulas */
      next
        case C_Send_case_1
        by contradiction /* from formulas */
      next
        case C_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case C_Request
      solve( State( ~cid, 'C1', $C, $S, 'client', auth_status ) ▶₀ #i )
        case C_1_bi
        by contradiction /* from formulas */
      next
        case C_1_uni
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_case_2
        by contradiction /* from formulas */
      next
        case C_Request_case_1
        by contradiction /* from formulas */
      next
        case C_Request_case_2
        by contradiction /* from formulas */
      next
        case C_Send_case_1
        by contradiction /* from formulas */
      next
        case C_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case C_Send
      solve( State( ~cid, 'C1', $C, $S, 'client', auth_status ) ▶₀ #i )
        case C_1_bi
        by contradiction /* from formulas */
      next
        case C_1_uni
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case C_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case C_Recv_case_1
        by contradiction /* from formulas */
      next
        case C_Recv_case_2
        by contradiction /* from formulas */
      next
        case C_Request_case_1
        by contradiction /* from formulas */
      next
        case C_Request_case_2
        by contradiction /* from formulas */
      next
        case C_Send_case_1
        by contradiction /* from formulas */
      next
        case C_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case S_Recv
      solve( State( ~sid, 'S1', $S, $C, 'server', auth_status ) ▶₀ #i )
        case S_1_bi
        by contradiction /* from formulas */
      next
        case S_1_uni
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case S_Recv_case_1
        by contradiction /* from formulas */
      next
        case S_Recv_case_2
        by contradiction /* from formulas */
      next
        case S_Request_case_1
        by contradiction /* from formulas */
      next
        case S_Request_case_2
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case S_Send_case_1
        by contradiction /* from formulas */
      next
        case S_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case S_RecvReq
      solve( State( ~sid, 'S1', $S, $C, 'server', auth_status ) ▶₀ #i )
        case S_1_bi
        by contradiction /* from formulas */
      next
        case S_1_uni
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case S_Recv_case_1
        by contradiction /* from formulas */
      next
        case S_Recv_case_2
        by contradiction /* from formulas */
      next
        case S_Request_case_1
        by contradiction /* from formulas */
      next
        case S_Request_case_2
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case S_Send_case_1
        by contradiction /* from formulas */
      next
        case S_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case S_Request
      solve( State( ~sid, 'S1', $S, $C, 'server', auth_status ) ▶₀ #i )
        case S_1_bi
        by contradiction /* from formulas */
      next
        case S_1_uni
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case S_Recv_case_1
        by contradiction /* from formulas */
      next
        case S_Recv_case_2
        by contradiction /* from formulas */
      next
        case S_Request_case_1
        by contradiction /* from formulas */
      next
        case S_Request_case_2
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case S_Send_case_1
        by contradiction /* from formulas */
      next
        case S_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case S_Send
      solve( State( ~sid, 'S1', $S, $C, 'server', auth_status ) ▶₀ #i )
        case S_1_bi
        by contradiction /* from formulas */
      next
        case S_1_uni
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case S_Recv_case_1
        by contradiction /* from formulas */
      next
        case S_Recv_case_2
        by contradiction /* from formulas */
      next
        case S_Request_case_1
        by contradiction /* from formulas */
      next
        case S_Request_case_2
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case S_Send_case_1
        by contradiction /* from formulas */
      next
        case S_Send_case_2
        by contradiction /* from formulas */
      qed
    next
      case S_Send_Spontaneous
      solve( State( ~sid, 'S1', $S, $C, 'server', auth_status ) ▶₀ #i )
        case S_1_bi
        by contradiction /* from formulas */
      next
        case S_1_uni
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_1
        by contradiction /* from formulas */
      next
        case S_RecvReq_case_2
        by contradiction /* from formulas */
      next
        case S_Recv_case_1
        by contradiction /* from formulas */
      next
        case S_Recv_case_2
        by contradiction /* from formulas */
      next
        case S_Request_case_1
        by contradiction /* from formulas */
      next
        case S_Request_case_2
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_1
        by contradiction /* from formulas */
      next
        case S_Send_Spontaneous_case_2
        by contradiction /* from formulas */
      next
        case S_Send_case_1
        by contradiction /* from formulas */
      next
        case S_Send_case_2
        by contradiction /* from formulas */
      qed
    qed
  next
    case case_2
    by contradiction /* from formulas */
  qed
qed

lemma one_prestart_per_tid [reuse]:
  all-traces
  "∀ tid actor actor2 peer peer2 role role2 #i #j.
    ((PreStart( tid, actor, peer, role ) @ #i) ∧
     (PreStart( tid, actor2, peer2, role2 ) @ #j)) ⇒
    (#i = #j)"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor actor2 peer peer2 role role2 #i #j.
  (PreStart( tid, actor, peer, role ) @ #i) ∧
  (PreStart( tid, actor2, peer2, role2 ) @ #j)
 ∧
  ¬(#i = #j)"
*/
simplify
solve( PreStart( tid, actor, peer, role ) @ #i )
  case C_0
  solve( PreStart( ~cid, actor2, peer2, role2 ) @ #j )
    case C_0
    by contradiction /* from formulas */
  qed
next
  case S_0
  solve( PreStart( ~sid, actor2, peer2, role2 ) @ #j )
    case S_0
    by contradiction /* from formulas */
  qed
qed

lemma one_start_per_tid [reuse]:
  all-traces
  "∀ tid actor actor2 peer peer2 role role2 #i #j.
    ((Start( tid, actor, peer, role ) @ #i) ∧
     (Start( tid, actor2, peer2, role2 ) @ #j)) ⇒
    (#i = #j)"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor actor2 peer peer2 role role2 #i #j.
  (Start( tid, actor, peer, role ) @ #i) ∧
  (Start( tid, actor2, peer2, role2 ) @ #j)
 ∧
  ¬(#i = #j)"
*/
simplify
by contradiction /* from formulas */

lemma ku_extract [reuse, use_induction]:
  all-traces
  "∀ a b #i.
    (!KU( Extract(a, b) ) @ #i) ⇒
    (∃ #j #k.
      (((!KU( a ) @ #j) ∧ (!KU( b ) @ #k)) ∧ (#j < #i)) ∧ (#k < #i))"
/*
guarded formula characterizing all counter-examples:
"∃ a b #i.
  (!KU( Extract(a, b) ) @ #i)
 ∧
  ∀ #j #k.
   (!KU( a ) @ #j) ∧ (!KU( b ) @ #k) ⇒ ((¬(#j < #i)) ∨ (¬(#k < #i)))"
*/
induction
  case empty_trace
  by contradiction /* from formulas */
next
  case non_empty_trace
  simplify
  solve( (last(#i))  ∥
         (∃ #j #k.
           (!KU( a ) @ #j) ∧ (!KU( b ) @ #k)
          ∧
           (¬(last(#k))) ∧ (¬(last(#j))) ∧ (#j < #i) ∧ (#k < #i)) )
    case case_1
    solve( !KU( Extract(a, b) ) @ #i )
      case c_Extract
      by contradiction /* from formulas */
    qed
  next
    case case_2
    by contradiction /* from formulas */
  qed
qed

lemma ku_expand [reuse, use_induction]:
  all-traces
  "∀ secret label len #i.
    (!KU( Expand(secret, label, len) ) @ #i) ⇒
    (∃ #j. (!KU( secret ) @ #j) ∧ (#j < #i))"
/*
guarded formula characterizing all counter-examples:
"∃ secret label len #i.
  (!KU( Expand(secret, label, len) ) @ #i)
 ∧
  ∀ #j. (!KU( secret ) @ #j) ⇒ ¬(#j < #i)"
*/
induction
  case empty_trace
  by contradiction /* from formulas */
next
  case non_empty_trace
  simplify
  solve( (last(#i))  ∥
         (∃ #j. (!KU( secret ) @ #j) ∧ (¬(last(#j))) ∧ (#j < #i)) )
    case case_1
    solve( !KU( Expand(secret, label, len) ) @ #i )
      case c_Expand
      by contradiction /* from formulas */
    qed
  next
    case case_2
    by contradiction /* from formulas */
  qed
qed

lemma constant_peer [reuse]:
  all-traces
  "∀ tid actor actor2 peer peer2 role role2 #i #j.
    ((Instance( tid, actor, peer, role ) @ #i) ∧
     (Start( tid, actor2, peer2, role2 ) @ #j)) ⇒
    (((actor = actor2) ∧ (peer = peer2)) ∧ (role = role2))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor actor2 peer peer2 role role2 #i #j.
  (Instance( tid, actor, peer, role ) @ #i) ∧
  (Start( tid, actor2, peer2, role2 ) @ #j)
 ∧
  ((¬(actor = actor2)) ∨ (¬(peer = peer2)) ∨ (¬(role = role2)))"
*/
simplify
by contradiction /* from formulas */

lemma consistent_nonce [reuse]:
  all-traces
  "∀ tid actor peer role actor2 peer2 role2 #i #j.
    ((Instance( tid, actor, peer, role ) @ #i) ∧
     (Instance( tid, actor2, peer2, role2 ) @ #j)) ⇒
    (((actor = actor2) ∧ (peer = peer2)) ∧ (role = role2))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor peer role actor2 peer2 role2 #i #j.
  (Instance( tid, actor, peer, role ) @ #i) ∧
  (Instance( tid, actor2, peer2, role2 ) @ #j)
 ∧
  ((¬(actor = actor2)) ∨ (¬(peer = peer2)) ∨ (¬(role = role2)))"
*/
simplify
by contradiction /* from formulas */

lemma send_recv [reuse]:
  all-traces
  "∀ actor peer role tid ms msg #k.
    ((Instance( tid, actor, peer, role ) @ #k) ∧
     (TLS_Recvd( ms, msg ) @ #k)) ⇒
    ((∃ #i. (TLS_Sent( ms, msg ) @ #i) ∧ (#i < #k)) ∨
     (∃ #j. (Revms( ms, actor, peer ) @ #j) ∧ (#j < #k)))"
/*
guarded formula characterizing all counter-examples:
"∃ actor peer role tid ms msg #k.
  (Instance( tid, actor, peer, role ) @ #k) ∧
  (TLS_Recvd( ms, msg ) @ #k)
 ∧
  (∀ #i. (TLS_Sent( ms, msg ) @ #i) ⇒ ¬(#i < #k)) ∧
  (∀ #j. (Revms( ms, actor, peer ) @ #j) ⇒ ¬(#j < #k))"
*/
induction
  case empty_trace
  by contradiction /* from formulas */
next
  case non_empty_trace
  simplify
  solve( (last(#k))  ∥
         (∃ #i. (TLS_Sent( ms, msg ) @ #i) ∧ (¬(last(#i))) ∧ (#i < #k))  ∥
         (∃ #j.
           (Revms( ms, actor, peer ) @ #j) ∧ (¬(last(#j))) ∧ (#j < #k)) )
    case case_1
    solve( TLS_Recvd( ms, msg ) @ #k )
      case C_Recv
      solve( Instance( tid, actor, peer, role ) @ #k )
        case C_Recv
        solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
               ) ▶₃ #k )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', certificate_request_context, pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', certificate_request_context, pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.4 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send
              by contradiction /* from formulas */
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', certificate_request_context, pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', certificate_request_context, pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    next
      case C_RecvReq
      solve( Instance( tid, actor, peer, role ) @ #k )
        case C_RecvReq
        solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
               ) ▶₂ #k )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~cid, $S, $C,
                           <'13', certificate_request_context, $certificate_extensions>
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <'13', certificate_request_context, $certificate_extensions>
                   ) ▶₀ #vr.4 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Request
              by contradiction /* from formulas */
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~cid, $S, $C,
                           <'13', certificate_request_context, $certificate_extensions>
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <'13', certificate_request_context, $certificate_extensions>
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Request
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    next
      case C_Recv_Spontaneous
      solve( Instance( tid, actor, peer, role ) @ #k )
        case C_Recv_Spontaneous
        solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
               ) ▶₂ #k )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'11', pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'11', pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.4 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send_Spontaneous
              by contradiction /* from formulas */
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'11', pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'11', pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send_Spontaneous
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    next
      case S_Recv
      solve( Instance( tid, actor, peer, role ) @ #k )
        case S_Recv
        solve( !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms
               ) ▶₃ #k )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~sid, $C, $S,
                           <<'11', certificate_request_context, pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <<'11', certificate_request_context, pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_clientauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_clientauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.4 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Send
              by contradiction /* from formulas */
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~sid, $C, $S,
                           <<'11', certificate_request_context, pk(ltkA)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkA)>)
                                  >,
                                  ltkA)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkA)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkA)>)
                                       >,
                                       ltkA)
                                 >)
                           >
                 ) ▶₁ #k )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <<'11', certificate_request_context, pk(ltkA)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_clientauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkA)>)
                                    >,
                                    ltkA)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(ltkA)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_clientauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkA)>)
                                         >,
                                         ltkA)
                                   >)
                             >
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Send
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    next
      case S_RecvReq
      solve( Instance( tid, actor, peer, role ) @ #k )
        case S_RecvReq
        solve( !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms
               ) ▶₂ #k )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~sid, $C, $S,
                           <'13', certificate_request_context, $certificate_extensions>
                 ) ▶₁ #k )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <'13', certificate_request_context, $certificate_extensions>
                   ) ▶₀ #vr.4 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Request
              by contradiction /* from formulas */
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~sid, $C, $S,
                           <'13', certificate_request_context, $certificate_extensions>
                 ) ▶₁ #k )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <'13', certificate_request_context, $certificate_extensions>
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Request
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    qed
  next
    case case_2
    by contradiction /* from formulas */
  next
    case case_3
    by contradiction /* from formulas */
  qed
qed

lemma crc_ctxt_source [sources]:
  all-traces
  "∀ actor ms role cr_ctxt #k.
    (RecvReq( actor, ms, role, cr_ctxt ) @ #k) ⇒
    ((∃ #i. (!KU( cr_ctxt ) @ #i) ∧ (#i < #k)) ∨
     (∃ tid peer role2 #j.
       ((Requested( tid, peer, role2, cr_ctxt ) @ #j) ∧ (#j < #k)) ∧
       (¬(role = role2))))"
/*
guarded formula characterizing all counter-examples:
"∃ actor ms role cr_ctxt #k.
  (RecvReq( actor, ms, role, cr_ctxt ) @ #k)
 ∧
  (∀ #i. (!KU( cr_ctxt ) @ #i) ⇒ ¬(#i < #k)) ∧
  (∀ tid peer role2 #j.
    (Requested( tid, peer, role2, cr_ctxt ) @ #j)
   ⇒
    ((¬(#j < #k)) ∨ (role = role2)))"
*/
by sorry

lemma req_before_fulfil [reuse]:
  all-traces
  "∀ tid actor role certificate_request_context cert #j.
    (Fulfil( tid, actor, role, certificate_request_context, cert
     ) @ #j) ⇒
    ((∃ tid2 actor2 role2 #i.
       (Requested( tid2, actor2, role2, certificate_request_context
        ) @ #i) ∧
       (#i < #j)) ∨
     (∃ #i. (!KU( certificate_request_context ) @ #i) ∧ (#i < #j)))"
/*
guarded formula characterizing all counter-examples:
"∃ tid actor role certificate_request_context cert #j.
  (Fulfil( tid, actor, role, certificate_request_context, cert
   ) @ #j)
 ∧
  (∀ tid2 actor2 role2 #i.
    (Requested( tid2, actor2, role2, certificate_request_context
     ) @ #i)
   ⇒
    ¬(#i < #j)) ∧
  (∀ #i. (!KU( certificate_request_context ) @ #i) ⇒ ¬(#i < #j))"
*/
simplify
solve( Fulfil( tid, actor, role, certificate_request_context, cert
       ) @ #j )
  case C_Send
  solve( PendingReqR( ~request_id, ~cid, 'client',
                      <'13', certificate_request_context, $certificate_extensions>
         ) ▶₁ #j )
    case C_RecvReq_case_1
    solve( TLS_Send( msg_id.1, ~sid, $S, $C,
                     <'13', certificate_request_context, $certificate_extensions>
           ) ▶₀ #vr.1 )
      case Adv_Send_TLS_target
      by contradiction /* from formulas */
    next
      case S_Request
      by contradiction /* from formulas */
    qed
  next
    case C_RecvReq_case_2
    solve( TLS_Send( msg_id.1, ~sid, $S, $C,
                     <'13', certificate_request_context, $certificate_extensions>
           ) ▶₀ #vr.1 )
      case Adv_Send_TLS_target
      by contradiction /* from formulas */
    next
      case S_Request
      by contradiction /* from formulas */
    qed
  qed
next
  case S_Send
  solve( PendingReqR( ~request_id, ~sid, 'server',
                      <'13', certificate_request_context, $certificate_extensions>
         ) ▶₁ #j )
    case S_RecvReq_case_1
    solve( TLS_Send( msg_id.1, ~cid, $C, $S,
                     <'13', certificate_request_context, $certificate_extensions>
           ) ▶₀ #vr.1 )
      case Adv_Send_TLS_owner
      by contradiction /* from formulas */
    next
      case C_Request
      by contradiction /* from formulas */
    qed
  next
    case S_RecvReq_case_2
    solve( TLS_Send( msg_id.1, ~cid, $C, $S,
                     <'13', certificate_request_context, $certificate_extensions>
           ) ▶₀ #vr.1 )
      case Adv_Send_TLS_owner
      by contradiction /* from formulas */
    next
      case C_Request
      by contradiction /* from formulas */
    qed
  qed
qed

lemma secret_session_keys:
  all-traces
  "∀ ms transcript #j #k.
    ((SessionKey( ms, transcript ) @ #j) ∧ (!KU( ms ) @ #k)) ⇒
    (∃ actor peer #i. (Revms( ms, actor, peer ) @ #i) ∧ (#i < #k))"
/*
guarded formula characterizing all counter-examples:
"∃ ms transcript #j #k.
  (SessionKey( ms, transcript ) @ #j) ∧ (!KU( ms ) @ #k)
 ∧
  ∀ actor peer #i. (Revms( ms, actor, peer ) @ #i) ⇒ ¬(#i < #k)"
*/
simplify
solve( !KU( ~n ) @ #k )
  case Reveal_ms_case_1
  by contradiction /* from formulas */
next
  case Reveal_ms_case_2
  by contradiction /* from formulas */
qed

lemma cert_ownership [reuse]:
  all-traces
  "∀ actor peer ms ltkD del role #k.
    (Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #k) ⇒
    ((∃ role2 #h.
       ((Owns( peer, ms, role2, <del, ltkD> ) @ #h) ∧ (#h < #k)) ∧
       (¬(role = role2))) ∨
     ((∃ #i. (RevLtk( ltkD, del ) @ #i) ∧ (#i < #k)) ∧
      (∃ #j. (Revms( ms, actor, peer ) @ #j) ∧ (#j < #k))))"
/*
guarded formula characterizing all counter-examples:
"∃ actor peer ms ltkD del role #k.
  (Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #k)
 ∧
  (∀ role2 #h.
    (Owns( peer, ms, role2, <del, ltkD> ) @ #h)
   ⇒
    ((¬(#h < #k)) ∨ (role = role2))) ∧
  (((∀ #i. (RevLtk( ltkD, del ) @ #i) ⇒ ¬(#i < #k)) ∨
    (∀ #j. (Revms( ms, actor, peer ) @ #j) ⇒ ¬(#j < #k))))"
*/
simplify
solve( Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #k )
  case C_Recv
  solve( !Pk( $A, pk(ltkD) ) ▶₄ #k )
    case Register_pk
    solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
           ) ▶₃ #k )
      case Create_TLS_channel_case_1
      solve( TLS_Recv( ~cid, $S, $C,
                       <<'11', certificate_request_context, pk(~ltk.1)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  pk(~ltk.1)>)
                              >,
                              ~ltk.1)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'13', certificate_request_context, $certificate_extensions>, 
                              <'11', certificate_request_context, pk(~ltk.1)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       <'13', certificate_request_context, $certificate_extensions
                                       >, 
                                       pk(~ltk.1)>)
                                   >,
                                   ~ltk.1)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_target
        solve( TLS_Send( msg_id, ~sid, $S, $C,
                         <<'11', certificate_request_context, pk(~ltk.1)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(~ltk.1)>)
                                >,
                                ~ltk.1)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(~ltk.1)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(~ltk.1)>)
                                     >,
                                     ~ltk.1)
                               >)
                         >
               ) ▶₀ #vr.5 )
          case Adv_Send_TLS_target
          solve( (∀ #i. (RevLtk( ~ltk.1, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $C, $S ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 <'13', certificate_request_context, $certificate_extensions>, 
                                 pk(~ltk.1)>)
                             >,
                             ~ltk.1)
                   ) @ #vk.11 )
              case Adv_Recv_TLS_target
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.1 ) @ #vk.16 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case S_Send
          by contradiction /* from formulas */
        qed
      qed
    next
      case Create_TLS_channel_case_2
      solve( TLS_Recv( ~cid, $S, $C,
                       <<'11', certificate_request_context, pk(~ltk.2)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  pk(~ltk.2)>)
                              >,
                              ~ltk.2)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'13', certificate_request_context, $certificate_extensions>, 
                              <'11', certificate_request_context, pk(~ltk.2)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       <'13', certificate_request_context, $certificate_extensions
                                       >, 
                                       pk(~ltk.2)>)
                                   >,
                                   ~ltk.2)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_target
        solve( TLS_Send( msg_id, ~sid, $S, $C,
                         <<'11', certificate_request_context, pk(~ltk.2)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(~ltk.2)>)
                                >,
                                ~ltk.2)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(~ltk.2)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(~ltk.2)>)
                                     >,
                                     ~ltk.2)
                               >)
                         >
               ) ▶₀ #vr.6 )
          case Adv_Send_TLS_target
          solve( (∀ #i. (RevLtk( ~ltk.2, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $C, $S ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 <'13', certificate_request_context, $certificate_extensions>, 
                                 pk(~ltk.2)>)
                             >,
                             ~ltk.2)
                   ) @ #vk.11 )
              case Adv_Recv_TLS_target
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.2 ) @ #vk.16 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case S_Send
          by contradiction /* from formulas */
        qed
      qed
    qed
  qed
next
  case C_Recv_Spontaneous
  solve( !Pk( $A, pk(ltkD) ) ▶₃ #k )
    case Register_pk
    solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
           ) ▶₂ #k )
      case Create_TLS_channel_case_1
      solve( TLS_Recv( ~cid, $S, $C,
                       <<'11', pk(~ltk.1)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  pk(~ltk.1)>)
                              >,
                              ~ltk.1)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'11', pk(~ltk.1)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       pk(~ltk.1)>)
                                   >,
                                   ~ltk.1)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_target
        solve( TLS_Send( msg_id, ~sid, $S, $C,
                         <<'11', pk(~ltk.1)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    pk(~ltk.1)>)
                                >,
                                ~ltk.1)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'11', pk(~ltk.1)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         pk(~ltk.1)>)
                                     >,
                                     ~ltk.1)
                               >)
                         >
               ) ▶₀ #vr.5 )
          case Adv_Send_TLS_target
          solve( (∀ #i. (RevLtk( ~ltk.1, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $C, $S ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 pk(~ltk.1)>)
                             >,
                             ~ltk.1)
                   ) @ #vk.9 )
              case Adv_Recv_TLS_target
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.1 ) @ #vk.14 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case S_Send_Spontaneous
          by contradiction /* from formulas */
        qed
      qed
    next
      case Create_TLS_channel_case_2
      solve( TLS_Recv( ~cid, $S, $C,
                       <<'11', pk(~ltk.2)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  pk(~ltk.2)>)
                              >,
                              ~ltk.2)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'11', pk(~ltk.2)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       pk(~ltk.2)>)
                                   >,
                                   ~ltk.2)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_target
        solve( TLS_Send( msg_id, ~sid, $S, $C,
                         <<'11', pk(~ltk.2)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    pk(~ltk.2)>)
                                >,
                                ~ltk.2)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'11', pk(~ltk.2)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         pk(~ltk.2)>)
                                     >,
                                     ~ltk.2)
                               >)
                         >
               ) ▶₀ #vr.6 )
          case Adv_Send_TLS_target
          solve( (∀ #i. (RevLtk( ~ltk.2, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $C, $S ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 pk(~ltk.2)>)
                             >,
                             ~ltk.2)
                   ) @ #vk.9 )
              case Adv_Recv_TLS_target
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.2 ) @ #vk.14 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case S_Send_Spontaneous
          by contradiction /* from formulas */
        qed
      qed
    qed
  qed
next
  case S_Recv
  solve( !Pk( $A, pk(ltkD) ) ▶₄ #k )
    case Register_pk
    solve( !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms
           ) ▶₃ #k )
      case Create_TLS_channel_case_1
      solve( TLS_Recv( ~sid, $C, $S,
                       <<'11', certificate_request_context, pk(~ltk.1)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  pk(~ltk.1)>)
                              >,
                              ~ltk.1)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_clientauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'13', certificate_request_context, $certificate_extensions>, 
                              <'11', certificate_request_context, pk(~ltk.1)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_clientauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       <'13', certificate_request_context, $certificate_extensions
                                       >, 
                                       pk(~ltk.1)>)
                                   >,
                                   ~ltk.1)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_owner
        solve( TLS_Send( msg_id, ~cid, $C, $S,
                         <<'11', certificate_request_context, pk(~ltk.1)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(~ltk.1)>)
                                >,
                                ~ltk.1)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(~ltk.1)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(~ltk.1)>)
                                     >,
                                     ~ltk.1)
                               >)
                         >
               ) ▶₀ #vr.5 )
          case Adv_Send_TLS_owner
          solve( (∀ #i. (RevLtk( ~ltk.1, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $S, $C ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_clientauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 <'13', certificate_request_context, $certificate_extensions>, 
                                 pk(~ltk.1)>)
                             >,
                             ~ltk.1)
                   ) @ #vk.11 )
              case Adv_Recv_TLS_owner
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.1 ) @ #vk.16 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case C_Send
          by contradiction /* from formulas */
        qed
      qed
    next
      case Create_TLS_channel_case_2
      solve( TLS_Recv( ~sid, $C, $S,
                       <<'11', certificate_request_context, pk(~ltk.2)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  pk(~ltk.2)>)
                              >,
                              ~ltk.2)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_clientauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'13', certificate_request_context, $certificate_extensions>, 
                              <'11', certificate_request_context, pk(~ltk.2)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_clientauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       <'13', certificate_request_context, $certificate_extensions
                                       >, 
                                       pk(~ltk.2)>)
                                   >,
                                   ~ltk.2)
                             >)
                       >
             ) ▶₁ #k )
        case Send_TLS_Channel_owner
        solve( TLS_Send( msg_id, ~cid, $C, $S,
                         <<'11', certificate_request_context, pk(~ltk.2)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(~ltk.2)>)
                                >,
                                ~ltk.2)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(~ltk.2)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(~ltk.2)>)
                                     >,
                                     ~ltk.2)
                               >)
                         >
               ) ▶₀ #vr.6 )
          case Adv_Send_TLS_owner
          solve( (∀ #i. (RevLtk( ~ltk.2, $A ) @ #i) ⇒ ¬(#i < #k))  ∥
                 (∀ #j. (Revms( ~n, $S, $C ) @ #j) ⇒ ¬(#j < #k)) )
            case case_1
            solve( !KU( sign(<'ExportedAuthenticator', 
                              h(<
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_clientauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'), 
                                 <'13', certificate_request_context, $certificate_extensions>, 
                                 pk(~ltk.2)>)
                             >,
                             ~ltk.2)
                   ) @ #vk.11 )
              case Adv_Recv_TLS_owner
              by contradiction /* from formulas */
            next
              case c_sign
              solve( !KU( ~ltk.2 ) @ #vk.16 )
                case Reveal_ltk
                by contradiction /* from formulas */
              qed
            qed
          next
            case case_2
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          qed
        next
          case C_Send
          by contradiction /* from formulas */
        qed
      qed
    qed
  qed
qed

lemma cert_linking:
  all-traces
  "∀ actor actor2 ms role role2 ltkD del ltkD2 del2 peer peer2 #j #k.
    (((Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #j) ∧
      (Recv( actor2, peer2, ms, role2, <del2, pk(ltkD2)> ) @ #k)) ∧
     (#j < #k)) ⇒
    ((∃ role3 role4 #h #i.
       (((((Owns( peer, ms, role3, <del, ltkD> ) @ #h) ∧
           (¬(role = role3))) ∧
          (#h < #j)) ∧
         (Owns( peer2, ms, role4, <del2, ltkD2> ) @ #i)) ∧
        (¬(role2 = role4))) ∧
       (#i < #k)) ∨
     (∃ #g. (Revms( ms, actor, peer ) @ #g) ∧ (#g < #k)))"
/*
guarded formula characterizing all counter-examples:
"∃ actor actor2 ms role role2 ltkD del ltkD2 del2 peer peer2 #j #k.
  (Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #j) ∧
  (Recv( actor2, peer2, ms, role2, <del2, pk(ltkD2)> ) @ #k)
 ∧
  (#j < #k) ∧
  (∀ role3 role4 #h #i.
    (Owns( peer, ms, role3, <del, ltkD> ) @ #h) ∧
    (Owns( peer2, ms, role4, <del2, ltkD2> ) @ #i)
   ⇒
    ((role = role3) ∨ (¬(#h < #j)) ∨ (role2 = role4) ∨ (¬(#i < #k)))) ∧
  (∀ #g. (Revms( ms, actor, peer ) @ #g) ⇒ ¬(#g < #k))"
*/
simplify
solve( (∃ role2 #h.
         (Owns( peer, ms, role2, <del, ltkD> ) @ #h)
        ∧
         (#h < #j) ∧ (¬(role = role2)))  ∥
       ((∃ #i. (RevLtk( ltkD, del ) @ #i) ∧ #i < #j) ∧
        (∃ #j.1. (Revms( ms, actor, peer ) @ #j.1) ∧ #j.1 < #j)) )
  case case_1
  solve( (∃ role2.1 #h.
           (Owns( peer2, ms, role2.1, <del2, ltkD2> ) @ #h)
          ∧
           (#h < #k) ∧ (¬(role2 = role2.1)))  ∥
         ((∃ #i. (RevLtk( ltkD2, del2 ) @ #i) ∧ #i < #k) ∧
          (∃ #j. (Revms( ms, actor2, peer2 ) @ #j) ∧ #j < #k)) )
    case case_1
    solve( Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #j )
      case C_Recv
      solve( PreStart( ~cid, $C, $S, 'client' ) @ #j.2 )
        case C_0
        solve( PendingReqI( ~request_id, ~cid, 'client',
                            <'13', certificate_request_context, $certificate_extensions>
               ) ▶₂ #j )
          case C_Request_case_1
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', ~certificate_request_context, pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<hccs, 
                                      <'13', ~certificate_request_context, $certificate_extensions
                                      >, 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<fms, hccs, 
                                  <'13', ~certificate_request_context, $certificate_extensions>, 
                                  <'11', ~certificate_request_context, pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<hccs, 
                                           <'13', ~certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₁ #j )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id.1, ~sid, $S, $C,
                             <<'11', ~certificate_request_context, pk(ltkD)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<hccs, 
                                        <'13', ~certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkD)>)
                                    >,
                                    ltkD)
                              >, 
                              '20', 
                              hmac(<fms, hccs, 
                                    <'13', ~certificate_request_context, $certificate_extensions>, 
                                    <'11', ~certificate_request_context, pk(ltkD)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<hccs, 
                                             <'13', ~certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkD)>)
                                         >,
                                         ltkD)
                                   >)
                             >
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
                       ) ▶₃ #j )
                  case Create_TLS_channel
                  by contradiction /* from formulas */
                qed
              qed
            next
              case S_Send
              solve( !Exporters( ms, 'client', ~cid, hccc,
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 
                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32'),
                                 fmc,
                                 Expand(Expand(Expand(~n,
                                                      <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                      '32'),
                                               <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                'empty'>,
                                               '32'),
                                        <'32', 'exporter', h('empty')>, '32')
                     ) ▶₃ #j )
                case Create_TLS_channel
                solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
                  case C_Send
                  by contradiction /* from formulas */
                next
                  case S_Send
                  by contradiction /* from formulas */
                next
                  case S_Send_Spontaneous
                  by contradiction /* from formulas */
                qed
              qed
            qed
          qed
        next
          case C_Request_case_2
          solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
                 ) ▶₃ #j )
            case Create_TLS_channel
            solve( TLS_Recv( ~cid, $S, $C,
                             <<'11', ~certificate_request_context, pk(ltkD)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', ~certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(ltkD)>)
                                    >,
                                    ltkD)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', ~certificate_request_context, $certificate_extensions>, 
                                    <'11', ~certificate_request_context, pk(ltkD)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', ~certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(ltkD)>)
                                         >,
                                         ltkD)
                                   >)
                             >
                   ) ▶₁ #j )
              case Send_TLS_Channel_target
              solve( TLS_Send( msg_id.1, ~sid, $S, $C,
                               <<'11', ~certificate_request_context, pk(ltkD)>, 
                                <'15', 
                                 sign(<'ExportedAuthenticator', 
                                       h(<
                                          Expand(Expand(Expand(~n,
                                                               <'32', 'TLS13exportermastersecret', 
                                                                h(~n.1)>,
                                                               '32'),
                                                        <'32', 
                                                         'EXPORTER_serverauthenticatorhandshakecontext', 
                                                         'empty'>,
                                                        '32'),
                                                 <'32', 'exporter', h('empty')>, '32'), 
                                          <'13', ~certificate_request_context, 
                                           $certificate_extensions>, 
                                          pk(ltkD)>)
                                      >,
                                      ltkD)
                                >, 
                                '20', 
                                hmac(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorfinishedkey', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', ~certificate_request_context, $certificate_extensions
                                      >, 
                                      <'11', ~certificate_request_context, pk(ltkD)>, '15', 
                                      sign(<'ExportedAuthenticator', 
                                            h(<
                                               Expand(Expand(Expand(~n,
                                                                    <'32', 
                                                                     'TLS13exportermastersecret', 
                                                                     h(~n.1)>,
                                                                    '32'),
                                                             <'32', 
                                                              'EXPORTER_serverauthenticatorhandshakecontext', 
                                                              'empty'>,
                                                             '32'),
                                                      <'32', 'exporter', h('empty')>, '32'), 
                                               <'13', ~certificate_request_context, 
                                                $certificate_extensions>, 
                                               pk(ltkD)>)
                                           >,
                                           ltkD)
                                     >)
                               >
                     ) ▶₀ #vr.6 )
                case Adv_Send_TLS_target
                solve( !KU( ~n ) @ #vk.1 )
                  case Reveal_ms
                  by contradiction /* from formulas */
                qed
              next
                case S_Send
                solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
                  case C_Send
                  by contradiction /* from formulas */
                next
                  case S_Send
                  by contradiction /* from formulas */
                next
                  case S_Send_Spontaneous
                  by contradiction /* from formulas */
                qed
              qed
            qed
          qed
        qed
      qed
    next
      case C_Recv_Spontaneous
      solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
             ) ▶₂ #j )
        case Create_TLS_channel_case_1
        solve( TLS_Recv( ~cid, $S, $C,
                         <<'11', pk(ltkD)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    pk(ltkD)>)
                                >,
                                ltkD)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'11', pk(ltkD)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         pk(ltkD)>)
                                     >,
                                     ltkD)
                               >)
                         >
               ) ▶₁ #j )
          case Send_TLS_Channel_target
          solve( TLS_Send( msg_id, ~sid, $S, $C,
                           <<'11', pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'11', pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₀ #vr.4 )
            case Adv_Send_TLS_target
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          next
            case S_Send_Spontaneous
            solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
              case C_Send
              by contradiction /* from formulas */
            next
              case S_Send
              by contradiction /* from formulas */
            next
              case S_Send_Spontaneous
              by contradiction /* from formulas */
            qed
          qed
        qed
      next
        case Create_TLS_channel_case_2
        solve( TLS_Recv( ~cid, $S, $C,
                         <<'11', pk(ltkD)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    pk(ltkD)>)
                                >,
                                ltkD)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'11', pk(ltkD)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         pk(ltkD)>)
                                     >,
                                     ltkD)
                               >)
                         >
               ) ▶₁ #j )
          case Send_TLS_Channel_target
          solve( TLS_Send( msg_id, ~sid, $S, $C,
                           <<'11', pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'11', pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₀ #vr.5 )
            case Adv_Send_TLS_target
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          next
            case S_Send_Spontaneous
            solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
              case C_Send
              by contradiction /* from formulas */
            next
              case S_Send
              by contradiction /* from formulas */
            next
              case S_Send_Spontaneous
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    next
      case S_Recv
      solve( !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms
             ) ▶₃ #j )
        case Create_TLS_channel_case_1
        solve( TLS_Recv( ~sid, $C, $S,
                         <<'11', certificate_request_context, pk(ltkD)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(ltkD)>)
                                >,
                                ltkD)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(ltkD)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(ltkD)>)
                                     >,
                                     ltkD)
                               >)
                         >
               ) ▶₁ #j )
          case Send_TLS_Channel_owner
          solve( TLS_Send( msg_id, ~cid, $C, $S,
                           <<'11', certificate_request_context, pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₀ #vr.4 )
            case Adv_Send_TLS_owner
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          next
            case C_Send
            solve( Owns( $C, ~n, role2, <$A, ~ltk> ) @ #h )
              case C_Send
              by contradiction /* from formulas */
            next
              case S_Send
              by contradiction /* from formulas */
            next
              case S_Send_Spontaneous
              by contradiction /* from formulas */
            qed
          qed
        qed
      next
        case Create_TLS_channel_case_2
        solve( TLS_Recv( ~sid, $C, $S,
                         <<'11', certificate_request_context, pk(ltkD)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(ltkD)>)
                                >,
                                ltkD)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(ltkD)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(ltkD)>)
                                     >,
                                     ltkD)
                               >)
                         >
               ) ▶₁ #j )
          case Send_TLS_Channel_owner
          solve( TLS_Send( msg_id, ~cid, $C, $S,
                           <<'11', certificate_request_context, pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₀ #vr.5 )
            case Adv_Send_TLS_owner
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          next
            case C_Send
            solve( !Pk( $A, pk(~ltk) ) ▶₄ #j )
              case Register_pk
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    qed
  next
    case case_2
    solve( Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #j )
      case C_Recv
      solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
             ) ▶₃ #j )
        case Create_TLS_channel_case_1
        solve( TLS_Recv( ~cid, $S, $C,
                         <<'11', certificate_request_context, pk(ltkD)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    pk(ltkD)>)
                                >,
                                ltkD)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'13', certificate_request_context, $certificate_extensions>, 
                                <'11', certificate_request_context, pk(ltkD)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         <'13', certificate_request_context, $certificate_extensions
                                         >, 
                                         pk(ltkD)>)
                                     >,
                                     ltkD)
                               >)
                         >
               ) ▶₁ #j )
          case Send_TLS_Channel_target
          solve( TLS_Send( msg_id, ~sid, $S, $C,
                           <<'11', certificate_request_context, pk(ltkD)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(ltkD)>)
                                  >,
                                  ltkD)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(ltkD)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(ltkD)>)
                                       >,
                                       ltkD)
                                 >)
                           >
                 ) ▶₀ #vr.4 )
            case Adv_Send_TLS_target
            solve( !KU( ~n ) @ #vk.1 )
              case Reveal_ms
              by contradiction /* from formulas */
            qed
          next
            case S_Send
            solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
              case C_Send
              by contradiction /* from formulas */
            next
              case S_Send
              solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                     ) ▶₂ #h )
                case Create_TLS_channel
                solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                  case C_Recv
                  solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                         ) ▶₃ #k )
                    case Create_TLS_channel
                    by contradiction /* from formulas */
                  qed
                next
                  case C_Recv_Spontaneous
                  solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                         ) ▶₂ #k )
                    case Create_TLS_channel
                    by contradiction /* from formulas */
                  qed
                next
                  case S_Recv
                  solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                         ) ▶₃ #k )
                    case Create_TLS_channel
                    solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                      case Register_pk
                      solve( TLS_Recv( ~sid, $C, $S,
                                       <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                        <'15', 
                                         sign(<'ExportedAuthenticator', 
                                               h(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.2, 
                                                   $certificate_extensions.2>, 
                                                  pk(~ltk.1)>)
                                              >,
                                              ~ltk.1)
                                        >, 
                                        '20', 
                                        hmac(<
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_clientauthenticatorfinishedkey', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_clientauthenticatorhandshakecontext', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              <'13', certificate_request_context.2, 
                                               $certificate_extensions.2>, 
                                              <'11', certificate_request_context.2, pk(~ltk.1)>, 
                                              '15', 
                                              sign(<'ExportedAuthenticator', 
                                                    h(<
                                                       Expand(Expand(Expand(~n,
                                                                            <'32', 
                                                                             'TLS13exportermastersecret', 
                                                                             h(~n.1)>,
                                                                            '32'),
                                                                     <'32', 
                                                                      'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                      'empty'>,
                                                                     '32'),
                                                              <'32', 'exporter', h('empty')>,
                                                              '32'), 
                                                       <'13', certificate_request_context.2, 
                                                        $certificate_extensions.2>, 
                                                       pk(~ltk.1)>)
                                                   >,
                                                   ~ltk.1)
                                             >)
                                       >
                             ) ▶₁ #k )
                        case Send_TLS_Channel_owner
                        solve( TLS_Send( msg_id.3, ~cid, $C, $S,
                                         <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.2, 
                                                     $certificate_extensions.2>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.2, 
                                                 $certificate_extensions.2>, 
                                                <'11', certificate_request_context.2, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context.2, 
                                                          $certificate_extensions.2>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₀ #vr.10 )
                          case Adv_Send_TLS_owner
                          solve( !KU( ~n ) @ #vk.1 )
                            case Reveal_ms
                            by contradiction /* from formulas */
                          qed
                        next
                          case C_Send
                          by contradiction /* from formulas */
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            next
              case S_Send_Spontaneous
              solve( !Pk( $A, pk(~ltk) ) ▶₄ #j )
                case Register_pk
                solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                       ) ▶₁ #h )
                  case Create_TLS_channel
                  solve( PreStart( ~cid, $C, $S, 'client' ) @ #j.2 )
                    case C_0
                    solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                      case C_Recv
                      solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                             ) ▶₃ #k )
                        case Create_TLS_channel
                        by contradiction /* from formulas */
                      qed
                    next
                      case C_Recv_Spontaneous
                      solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                             ) ▶₂ #k )
                        case Create_TLS_channel
                        by contradiction /* from formulas */
                      qed
                    next
                      case S_Recv
                      solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                             ) ▶₃ #k )
                        case Create_TLS_channel
                        solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                          case Register_pk
                          solve( TLS_Recv( ~sid, $C, $S,
                                           <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context.1, 
                                                       $certificate_extensions.1>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.1, 
                                                   $certificate_extensions.1>, 
                                                  <'11', certificate_request_context.1, pk(~ltk.1)
                                                  >, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context.1, 
                                                            $certificate_extensions.1>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₁ #k )
                            case Send_TLS_Channel_owner
                            solve( TLS_Send( msg_id.3, ~cid, $C, $S,
                                             <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                              <'15', 
                                               sign(<'ExportedAuthenticator', 
                                                     h(<
                                                        Expand(Expand(Expand(~n,
                                                                             <'32', 
                                                                              'TLS13exportermastersecret', 
                                                                              h(~n.1)>,
                                                                             '32'),
                                                                      <'32', 
                                                                       'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                       'empty'>,
                                                                      '32'),
                                                               <'32', 'exporter', h('empty')>,
                                                               '32'), 
                                                        <'13', certificate_request_context.1, 
                                                         $certificate_extensions.1>, 
                                                        pk(~ltk.1)>)
                                                    >,
                                                    ~ltk.1)
                                              >, 
                                              '20', 
                                              hmac(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorfinishedkey', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.1, 
                                                     $certificate_extensions.1>, 
                                                    <'11', certificate_request_context.1, pk(~ltk.1)
                                                    >, 
                                                    '15', 
                                                    sign(<'ExportedAuthenticator', 
                                                          h(<
                                                             Expand(Expand(Expand(~n,
                                                                                  <'32', 
                                                                                   'TLS13exportermastersecret', 
                                                                                   h(~n.1)>,
                                                                                  '32'),
                                                                           <'32', 
                                                                            'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                            'empty'>,
                                                                           '32'),
                                                                    <'32', 'exporter', h('empty')>,
                                                                    '32'), 
                                                             <'13', certificate_request_context.1, 
                                                              $certificate_extensions.1>, 
                                                             pk(~ltk.1)>)
                                                         >,
                                                         ~ltk.1)
                                                   >)
                                             >
                                   ) ▶₀ #vr.10 )
                              case Adv_Send_TLS_owner
                              solve( !KU( ~n ) @ #vk.1 )
                                case Reveal_ms
                                by contradiction /* from formulas */
                              qed
                            next
                              case C_Send
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case Create_TLS_channel_case_2
        solve( !Pk( $A, pk(ltkD) ) ▶₄ #j )
          case Register_pk
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', certificate_request_context, pk(~ltk)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(~ltk)>)
                                  >,
                                  ~ltk)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(~ltk)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(~ltk)>)
                                       >,
                                       ~ltk)
                                 >)
                           >
                 ) ▶₁ #j )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', certificate_request_context, pk(~ltk)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(~ltk)>)
                                    >,
                                    ~ltk)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(~ltk)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(~ltk)>)
                                         >,
                                         ~ltk)
                                   >)
                             >
                   ) ▶₀ #vr.6 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send
              solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
                case C_Send
                by contradiction /* from formulas */
              next
                case S_Send
                solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                  case C_Recv
                  solve( !Exporters( ~n, 'client', ~cid.1, hccc.1, hccs.1, fmc.1,
                                     fms.1
                         ) ▶₃ #k )
                    case Create_TLS_channel
                    by contradiction /* from formulas */
                  qed
                next
                  case C_Recv_Spontaneous
                  solve( !Exporters( ~n, 'client', ~cid.1, hccc.1, hccs.1, fmc.1,
                                     fms.1
                         ) ▶₂ #k )
                    case Create_TLS_channel
                    by contradiction /* from formulas */
                  qed
                next
                  case S_Recv
                  solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                         ) ▶₂ #h )
                    case Create_TLS_channel
                    solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                      case Register_pk
                      solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                             ) ▶₃ #k )
                        case Create_TLS_channel
                        solve( TLS_Recv( ~sid, $C, $S,
                                         <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.2, 
                                                     $certificate_extensions.2>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.2, 
                                                 $certificate_extensions.2>, 
                                                <'11', certificate_request_context.2, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context.2, 
                                                          $certificate_extensions.2>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_owner
                          solve( TLS_Send( msg_id.3, ~cid, $C, $S,
                                           <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context.2, 
                                                       $certificate_extensions.2>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.2, 
                                                   $certificate_extensions.2>, 
                                                  <'11', certificate_request_context.2, pk(~ltk.1)
                                                  >, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context.2, 
                                                            $certificate_extensions.2>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.11 )
                            case Adv_Send_TLS_owner
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case C_Send
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              next
                case S_Send_Spontaneous
                solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                       ) ▶₁ #h )
                  case Create_TLS_channel
                  solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                    case C_Recv
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case C_Recv_Spontaneous
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₂ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case S_Recv
                    solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                      case Register_pk
                      solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                             ) ▶₃ #k )
                        case Create_TLS_channel
                        solve( TLS_Recv( ~sid, $C, $S,
                                         <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.1, 
                                                     $certificate_extensions.1>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.1, 
                                                 $certificate_extensions.1>, 
                                                <'11', certificate_request_context.1, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context.1, 
                                                          $certificate_extensions.1>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_owner
                          solve( TLS_Send( msg_id.3, ~cid, $C, $S,
                                           <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context.1, 
                                                       $certificate_extensions.1>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.1, 
                                                   $certificate_extensions.1>, 
                                                  <'11', certificate_request_context.1, pk(~ltk.1)
                                                  >, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context.1, 
                                                            $certificate_extensions.1>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.11 )
                            case Adv_Send_TLS_owner
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case C_Send
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      qed
    next
      case C_Recv_Spontaneous
      solve( !Pk( $A, pk(ltkD) ) ▶₃ #j )
        case Register_pk
        solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
               ) ▶₂ #j )
          case Create_TLS_channel_case_1
          solve( Recv( actor2, peer2, ~n, role2.1, <del2, pk(ltkD2)> ) @ #k )
            case C_Recv
            solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                   ) ▶₃ #k )
              case Create_TLS_channel
              by contradiction /* from formulas */
            qed
          next
            case C_Recv_Spontaneous
            solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                   ) ▶₂ #k )
              case Create_TLS_channel
              by contradiction /* from formulas */
            qed
          next
            case S_Recv
            solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                   ) ▶₃ #k )
              case Create_TLS_channel
              solve( TLS_Recv( ~cid, $S, $C,
                               <<'11', pk(~ltk)>, 
                                <'15', 
                                 sign(<'ExportedAuthenticator', 
                                       h(<
                                          Expand(Expand(Expand(~n,
                                                               <'32', 'TLS13exportermastersecret', 
                                                                h(~n.1)>,
                                                               '32'),
                                                        <'32', 
                                                         'EXPORTER_serverauthenticatorhandshakecontext', 
                                                         'empty'>,
                                                        '32'),
                                                 <'32', 'exporter', h('empty')>, '32'), 
                                          pk(~ltk)>)
                                      >,
                                      ~ltk)
                                >, 
                                '20', 
                                hmac(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorfinishedkey', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'11', pk(~ltk)>, '15', 
                                      sign(<'ExportedAuthenticator', 
                                            h(<
                                               Expand(Expand(Expand(~n,
                                                                    <'32', 
                                                                     'TLS13exportermastersecret', 
                                                                     h(~n.1)>,
                                                                    '32'),
                                                             <'32', 
                                                              'EXPORTER_serverauthenticatorhandshakecontext', 
                                                              'empty'>,
                                                             '32'),
                                                      <'32', 'exporter', h('empty')>, '32'), 
                                               pk(~ltk)>)
                                           >,
                                           ~ltk)
                                     >)
                               >
                     ) ▶₁ #j )
                case Send_TLS_Channel_target
                solve( !Pk( $A, pk(ltkD2) ) ▶₄ #k )
                  case Register_pk
                  solve( TLS_Send( msg_id, ~sid, $S, $C,
                                   <<'11', pk(~ltk.1)>, 
                                    <'15', 
                                     sign(<'ExportedAuthenticator', 
                                           h(<
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_serverauthenticatorhandshakecontext', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              pk(~ltk.1)>)
                                          >,
                                          ~ltk.1)
                                    >, 
                                    '20', 
                                    hmac(<
                                          Expand(Expand(Expand(~n,
                                                               <'32', 'TLS13exportermastersecret', 
                                                                h(~n.1)>,
                                                               '32'),
                                                        <'32', 
                                                         'EXPORTER_serverauthenticatorfinishedkey', 
                                                         'empty'>,
                                                        '32'),
                                                 <'32', 'exporter', h('empty')>, '32'), 
                                          Expand(Expand(Expand(~n,
                                                               <'32', 'TLS13exportermastersecret', 
                                                                h(~n.1)>,
                                                               '32'),
                                                        <'32', 
                                                         'EXPORTER_serverauthenticatorhandshakecontext', 
                                                         'empty'>,
                                                        '32'),
                                                 <'32', 'exporter', h('empty')>, '32'), 
                                          <'11', pk(~ltk.1)>, '15', 
                                          sign(<'ExportedAuthenticator', 
                                                h(<
                                                   Expand(Expand(Expand(~n,
                                                                        <'32', 
                                                                         'TLS13exportermastersecret', 
                                                                         h(~n.1)>,
                                                                        '32'),
                                                                 <'32', 
                                                                  'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                  'empty'>,
                                                                 '32'),
                                                          <'32', 'exporter', h('empty')>, '32'), 
                                                   pk(~ltk.1)>)
                                               >,
                                               ~ltk.1)
                                         >)
                                   >
                         ) ▶₀ #vr.5 )
                    case Adv_Send_TLS_target
                    solve( !KU( ~n ) @ #vk.1 )
                      case Reveal_ms
                      by contradiction /* from formulas */
                    qed
                  next
                    case S_Send_Spontaneous
                    solve( TLS_Recv( ~sid, $C, $S,
                                     <<'11', certificate_request_context, pk(~ltk)>, 
                                      <'15', 
                                       sign(<'ExportedAuthenticator', 
                                             h(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context, 
                                                 $certificate_extensions>, 
                                                pk(~ltk)>)
                                            >,
                                            ~ltk)
                                      >, 
                                      '20', 
                                      hmac(<
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_clientauthenticatorfinishedkey', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_clientauthenticatorhandshakecontext', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            <'13', certificate_request_context, 
                                             $certificate_extensions>, 
                                            <'11', certificate_request_context, pk(~ltk)>, '15', 
                                            sign(<'ExportedAuthenticator', 
                                                  h(<
                                                     Expand(Expand(Expand(~n,
                                                                          <'32', 
                                                                           'TLS13exportermastersecret', 
                                                                           h(~n.1)>,
                                                                          '32'),
                                                                   <'32', 
                                                                    'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                    'empty'>,
                                                                   '32'),
                                                            <'32', 'exporter', h('empty')>, '32'), 
                                                     <'13', certificate_request_context, 
                                                      $certificate_extensions>, 
                                                     pk(~ltk)>)
                                                 >,
                                                 ~ltk)
                                           >)
                                     >
                           ) ▶₁ #k )
                      case Send_TLS_Channel_owner
                      solve( TLS_Send( msg_id.1, ~cid, $C, $S,
                                       <<'11', certificate_request_context, pk(~ltk)>, 
                                        <'15', 
                                         sign(<'ExportedAuthenticator', 
                                               h(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context, 
                                                   $certificate_extensions>, 
                                                  pk(~ltk)>)
                                              >,
                                              ~ltk)
                                        >, 
                                        '20', 
                                        hmac(<
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_clientauthenticatorfinishedkey', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_clientauthenticatorhandshakecontext', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              <'13', certificate_request_context, 
                                               $certificate_extensions>, 
                                              <'11', certificate_request_context, pk(~ltk)>, '15', 
                                              sign(<'ExportedAuthenticator', 
                                                    h(<
                                                       Expand(Expand(Expand(~n,
                                                                            <'32', 
                                                                             'TLS13exportermastersecret', 
                                                                             h(~n.1)>,
                                                                            '32'),
                                                                     <'32', 
                                                                      'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                      'empty'>,
                                                                     '32'),
                                                              <'32', 'exporter', h('empty')>,
                                                              '32'), 
                                                       <'13', certificate_request_context, 
                                                        $certificate_extensions>, 
                                                       pk(~ltk)>)
                                                   >,
                                                   ~ltk)
                                             >)
                                       >
                             ) ▶₀ #vr.8 )
                        case Adv_Send_TLS_owner
                        solve( !KU( ~n ) @ #vk.1 )
                          case Reveal_ms
                          by contradiction /* from formulas */
                        qed
                      next
                        case C_Send
                        by contradiction /* from formulas */
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~cid, $S, $C,
                           <<'11', pk(~ltk)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      pk(~ltk)>)
                                  >,
                                  ~ltk)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'11', pk(~ltk)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(~ltk)>)
                                       >,
                                       ~ltk)
                                 >)
                           >
                 ) ▶₁ #j )
            case Send_TLS_Channel_target
            solve( TLS_Send( msg_id, ~sid, $S, $C,
                             <<'11', pk(~ltk)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        pk(~ltk)>)
                                    >,
                                    ~ltk)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'11', pk(~ltk)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_serverauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             pk(~ltk)>)
                                         >,
                                         ~ltk)
                                   >)
                             >
                   ) ▶₀ #vr.6 )
              case Adv_Send_TLS_target
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case S_Send_Spontaneous
              solve( Owns( $S, ~n, role2, <$A, ~ltk> ) @ #h )
                case C_Send
                by contradiction /* from formulas */
              next
                case S_Send
                solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                       ) ▶₂ #h )
                  case Create_TLS_channel
                  solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                    case C_Recv
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case C_Recv_Spontaneous
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₂ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case S_Recv
                    solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                        case Register_pk
                        solve( TLS_Recv( ~sid, $C, $S,
                                         <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.1, 
                                                     $certificate_extensions.1>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.1, 
                                                 $certificate_extensions.1>, 
                                                <'11', certificate_request_context.1, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context.1, 
                                                          $certificate_extensions.1>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_owner
                          solve( TLS_Send( msg_id.2, ~cid, $C, $S,
                                           <<'11', certificate_request_context.1, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context.1, 
                                                       $certificate_extensions.1>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.1, 
                                                   $certificate_extensions.1>, 
                                                  <'11', certificate_request_context.1, pk(~ltk.1)
                                                  >, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context.1, 
                                                            $certificate_extensions.1>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.9 )
                            case Adv_Send_TLS_owner
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case C_Send
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              next
                case S_Send_Spontaneous
                solve( !Exporters( ~n, 'server', ~sid, hccc, hccs, fmc, fms
                       ) ▶₁ #h )
                  case Create_TLS_channel
                  solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                    case C_Recv
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case C_Recv_Spontaneous
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₂ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  next
                    case S_Recv
                    solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                      case Register_pk
                      solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                             ) ▶₃ #k )
                        case Create_TLS_channel
                        solve( TLS_Recv( ~sid, $C, $S,
                                         <<'11', certificate_request_context, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context, 
                                                     $certificate_extensions>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_clientauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context, 
                                                 $certificate_extensions>, 
                                                <'11', certificate_request_context, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context, 
                                                          $certificate_extensions>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_owner
                          solve( TLS_Send( msg_id.2, ~cid, $C, $S,
                                           <<'11', certificate_request_context, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context, 
                                                       $certificate_extensions>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context, 
                                                   $certificate_extensions>, 
                                                  <'11', certificate_request_context, pk(~ltk.1)>, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context, 
                                                            $certificate_extensions>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.9 )
                            case Adv_Send_TLS_owner
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case C_Send
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      qed
    next
      case S_Recv
      solve( !Pk( $A, pk(ltkD) ) ▶₄ #j )
        case Register_pk
        solve( !Exporters( ms, 'server', ~sid, hccc, hccs, fmc, fms
               ) ▶₃ #j )
          case Create_TLS_channel_case_1
          solve( TLS_Recv( ~sid, $C, $S,
                           <<'11', certificate_request_context, pk(~ltk)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(~ltk)>)
                                  >,
                                  ~ltk)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(~ltk)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(~ltk)>)
                                       >,
                                       ~ltk)
                                 >)
                           >
                 ) ▶₁ #j )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <<'11', certificate_request_context, pk(~ltk)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_clientauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(~ltk)>)
                                    >,
                                    ~ltk)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(~ltk)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_clientauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(~ltk)>)
                                         >,
                                         ~ltk)
                                   >)
                             >
                   ) ▶₀ #vr.5 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Send
              solve( Owns( $C, ~n, role2, <$A, ~ltk> ) @ #h )
                case C_Send
                solve( !Exporters( ~n, 'client', ~cid, hccc, hccs, fmc, fms
                       ) ▶₂ #h )
                  case Create_TLS_channel
                  solve( Recv( actor2, peer2, ~n, role2, <del2, pk(ltkD2)> ) @ #k )
                    case C_Recv
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      solve( !Pk( $A.1, pk(ltkD2) ) ▶₄ #k )
                        case Register_pk
                        solve( TLS_Recv( ~cid, $S, $C,
                                         <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    <'13', certificate_request_context.2, 
                                                     $certificate_extensions.2>, 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.2, 
                                                 $certificate_extensions.2>, 
                                                <'11', certificate_request_context.2, pk(~ltk.1)>, 
                                                '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         <'13', certificate_request_context.2, 
                                                          $certificate_extensions.2>, 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_target
                          solve( TLS_Send( msg_id.3, ~sid, $S, $C,
                                           <<'11', certificate_request_context.2, pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      <'13', certificate_request_context.2, 
                                                       $certificate_extensions.2>, 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.2, 
                                                   $certificate_extensions.2>, 
                                                  <'11', certificate_request_context.2, pk(~ltk.1)
                                                  >, 
                                                  '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           <'13', certificate_request_context.2, 
                                                            $certificate_extensions.2>, 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.10 )
                            case Adv_Send_TLS_target
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case S_Send
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  next
                    case C_Recv_Spontaneous
                    solve( !Exporters( ~n, 'client', ~cid.1, hccc, hccs, fmc, fms
                           ) ▶₂ #k )
                      case Create_TLS_channel
                      solve( !Pk( $A.1, pk(ltkD2) ) ▶₃ #k )
                        case Register_pk
                        solve( TLS_Recv( ~cid, $S, $C,
                                         <<'11', pk(~ltk.1)>, 
                                          <'15', 
                                           sign(<'ExportedAuthenticator', 
                                                 h(<
                                                    Expand(Expand(Expand(~n,
                                                                         <'32', 
                                                                          'TLS13exportermastersecret', 
                                                                          h(~n.1)>,
                                                                         '32'),
                                                                  <'32', 
                                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                   'empty'>,
                                                                  '32'),
                                                           <'32', 'exporter', h('empty')>, '32'), 
                                                    pk(~ltk.1)>)
                                                >,
                                                ~ltk.1)
                                          >, 
                                          '20', 
                                          hmac(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorfinishedkey', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'11', pk(~ltk.1)>, '15', 
                                                sign(<'ExportedAuthenticator', 
                                                      h(<
                                                         Expand(Expand(Expand(~n,
                                                                              <'32', 
                                                                               'TLS13exportermastersecret', 
                                                                               h(~n.1)>,
                                                                              '32'),
                                                                       <'32', 
                                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                        'empty'>,
                                                                       '32'),
                                                                <'32', 'exporter', h('empty')>,
                                                                '32'), 
                                                         pk(~ltk.1)>)
                                                     >,
                                                     ~ltk.1)
                                               >)
                                         >
                               ) ▶₁ #k )
                          case Send_TLS_Channel_target
                          solve( TLS_Send( msg_id.3, ~sid, $S, $C,
                                           <<'11', pk(~ltk.1)>, 
                                            <'15', 
                                             sign(<'ExportedAuthenticator', 
                                                   h(<
                                                      Expand(Expand(Expand(~n,
                                                                           <'32', 
                                                                            'TLS13exportermastersecret', 
                                                                            h(~n.1)>,
                                                                           '32'),
                                                                    <'32', 
                                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                     'empty'>,
                                                                    '32'),
                                                             <'32', 'exporter', h('empty')>, '32'), 
                                                      pk(~ltk.1)>)
                                                  >,
                                                  ~ltk.1)
                                            >, 
                                            '20', 
                                            hmac(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorfinishedkey', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'11', pk(~ltk.1)>, '15', 
                                                  sign(<'ExportedAuthenticator', 
                                                        h(<
                                                           Expand(Expand(Expand(~n,
                                                                                <'32', 
                                                                                 'TLS13exportermastersecret', 
                                                                                 h(~n.1)>,
                                                                                '32'),
                                                                         <'32', 
                                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                          'empty'>,
                                                                         '32'),
                                                                  <'32', 'exporter', h('empty')>,
                                                                  '32'), 
                                                           pk(~ltk.1)>)
                                                       >,
                                                       ~ltk.1)
                                                 >)
                                           >
                                 ) ▶₀ #vr.10 )
                            case Adv_Send_TLS_target
                            solve( !KU( ~n ) @ #vk.1 )
                              case Reveal_ms
                              by contradiction /* from formulas */
                            qed
                          next
                            case S_Send_Spontaneous
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  next
                    case S_Recv
                    solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                           ) ▶₃ #k )
                      case Create_TLS_channel
                      by contradiction /* from formulas */
                    qed
                  qed
                qed
              next
                case S_Send
                by contradiction /* from formulas */
              next
                case S_Send_Spontaneous
                by contradiction /* from formulas */
              qed
            qed
          qed
        next
          case Create_TLS_channel_case_2
          solve( TLS_Recv( ~sid, $C, $S,
                           <<'11', certificate_request_context, pk(~ltk)>, 
                            <'15', 
                             sign(<'ExportedAuthenticator', 
                                   h(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_clientauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'13', certificate_request_context, $certificate_extensions>, 
                                      pk(~ltk)>)
                                  >,
                                  ~ltk)
                            >, 
                            '20', 
                            hmac(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_clientauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  <'13', certificate_request_context, $certificate_extensions>, 
                                  <'11', certificate_request_context, pk(~ltk)>, '15', 
                                  sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_clientauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           <'13', certificate_request_context, 
                                            $certificate_extensions>, 
                                           pk(~ltk)>)
                                       >,
                                       ~ltk)
                                 >)
                           >
                 ) ▶₁ #j )
            case Send_TLS_Channel_owner
            solve( TLS_Send( msg_id, ~cid, $C, $S,
                             <<'11', certificate_request_context, pk(~ltk)>, 
                              <'15', 
                               sign(<'ExportedAuthenticator', 
                                     h(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_clientauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'13', certificate_request_context, $certificate_extensions
                                        >, 
                                        pk(~ltk)>)
                                    >,
                                    ~ltk)
                              >, 
                              '20', 
                              hmac(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 'EXPORTER_clientauthenticatorfinishedkey', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_clientauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    <'13', certificate_request_context, $certificate_extensions>, 
                                    <'11', certificate_request_context, pk(~ltk)>, '15', 
                                    sign(<'ExportedAuthenticator', 
                                          h(<
                                             Expand(Expand(Expand(~n,
                                                                  <'32', 
                                                                   'TLS13exportermastersecret', 
                                                                   h(~n.1)>,
                                                                  '32'),
                                                           <'32', 
                                                            'EXPORTER_clientauthenticatorhandshakecontext', 
                                                            'empty'>,
                                                           '32'),
                                                    <'32', 'exporter', h('empty')>, '32'), 
                                             <'13', certificate_request_context, 
                                              $certificate_extensions>, 
                                             pk(~ltk)>)
                                         >,
                                         ~ltk)
                                   >)
                             >
                   ) ▶₀ #vr.6 )
              case Adv_Send_TLS_owner
              solve( !KU( ~n ) @ #vk.1 )
                case Reveal_ms
                by contradiction /* from formulas */
              qed
            next
              case C_Send
              solve( Recv( actor2, peer2, ~n, role2.1, <del2, pk(ltkD2)> ) @ #k )
                case C_Recv
                solve( !Exporters( ~n, 'client', ~cid, hccc, hccs, fmc, fms
                       ) ▶₃ #k )
                  case Create_TLS_channel
                  solve( !Pk( $A, pk(ltkD2) ) ▶₄ #k )
                    case Register_pk
                    solve( TLS_Recv( ~cid, $S, $C,
                                     <<'11', certificate_request_context.1, pk(~ltk)>, 
                                      <'15', 
                                       sign(<'ExportedAuthenticator', 
                                             h(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                <'13', certificate_request_context.1, 
                                                 $certificate_extensions.1>, 
                                                pk(~ltk)>)
                                            >,
                                            ~ltk)
                                      >, 
                                      '20', 
                                      hmac(<
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_serverauthenticatorfinishedkey', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_serverauthenticatorhandshakecontext', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            <'13', certificate_request_context.1, 
                                             $certificate_extensions.1>, 
                                            <'11', certificate_request_context.1, pk(~ltk)>, '15', 
                                            sign(<'ExportedAuthenticator', 
                                                  h(<
                                                     Expand(Expand(Expand(~n,
                                                                          <'32', 
                                                                           'TLS13exportermastersecret', 
                                                                           h(~n.1)>,
                                                                          '32'),
                                                                   <'32', 
                                                                    'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                    'empty'>,
                                                                   '32'),
                                                            <'32', 'exporter', h('empty')>, '32'), 
                                                     <'13', certificate_request_context.1, 
                                                      $certificate_extensions.1>, 
                                                     pk(~ltk)>)
                                                 >,
                                                 ~ltk)
                                           >)
                                     >
                           ) ▶₁ #k )
                      case Send_TLS_Channel_target
                      solve( TLS_Send( msg_id.2, ~sid, $S, $C,
                                       <<'11', certificate_request_context.1, pk(~ltk)>, 
                                        <'15', 
                                         sign(<'ExportedAuthenticator', 
                                               h(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  <'13', certificate_request_context.1, 
                                                   $certificate_extensions.1>, 
                                                  pk(~ltk)>)
                                              >,
                                              ~ltk)
                                        >, 
                                        '20', 
                                        hmac(<
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_serverauthenticatorfinishedkey', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_serverauthenticatorhandshakecontext', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              <'13', certificate_request_context.1, 
                                               $certificate_extensions.1>, 
                                              <'11', certificate_request_context.1, pk(~ltk)>, 
                                              '15', 
                                              sign(<'ExportedAuthenticator', 
                                                    h(<
                                                       Expand(Expand(Expand(~n,
                                                                            <'32', 
                                                                             'TLS13exportermastersecret', 
                                                                             h(~n.1)>,
                                                                            '32'),
                                                                     <'32', 
                                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                      'empty'>,
                                                                     '32'),
                                                              <'32', 'exporter', h('empty')>,
                                                              '32'), 
                                                       <'13', certificate_request_context.1, 
                                                        $certificate_extensions.1>, 
                                                       pk(~ltk)>)
                                                   >,
                                                   ~ltk)
                                             >)
                                       >
                             ) ▶₀ #vr.11 )
                        case Adv_Send_TLS_target
                        solve( !KU( ~n ) @ #vk.1 )
                          case Reveal_ms
                          by contradiction /* from formulas */
                        qed
                      next
                        case S_Send
                        by contradiction /* from formulas */
                      qed
                    qed
                  qed
                qed
              next
                case C_Recv_Spontaneous
                solve( !Exporters( ~n, 'client', ~cid, hccc, hccs, fmc, fms
                       ) ▶₂ #k )
                  case Create_TLS_channel
                  solve( !Pk( $A, pk(ltkD2) ) ▶₃ #k )
                    case Register_pk
                    solve( TLS_Recv( ~cid, $S, $C,
                                     <<'11', pk(~ltk)>, 
                                      <'15', 
                                       sign(<'ExportedAuthenticator', 
                                             h(<
                                                Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32'), 
                                                pk(~ltk)>)
                                            >,
                                            ~ltk)
                                      >, 
                                      '20', 
                                      hmac(<
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_serverauthenticatorfinishedkey', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_serverauthenticatorhandshakecontext', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            <'11', pk(~ltk)>, '15', 
                                            sign(<'ExportedAuthenticator', 
                                                  h(<
                                                     Expand(Expand(Expand(~n,
                                                                          <'32', 
                                                                           'TLS13exportermastersecret', 
                                                                           h(~n.1)>,
                                                                          '32'),
                                                                   <'32', 
                                                                    'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                    'empty'>,
                                                                   '32'),
                                                            <'32', 'exporter', h('empty')>, '32'), 
                                                     pk(~ltk)>)
                                                 >,
                                                 ~ltk)
                                           >)
                                     >
                           ) ▶₁ #k )
                      case Send_TLS_Channel_target
                      solve( TLS_Send( msg_id.2, ~sid, $S, $C,
                                       <<'11', pk(~ltk)>, 
                                        <'15', 
                                         sign(<'ExportedAuthenticator', 
                                               h(<
                                                  Expand(Expand(Expand(~n,
                                                                       <'32', 
                                                                        'TLS13exportermastersecret', 
                                                                        h(~n.1)>,
                                                                       '32'),
                                                                <'32', 
                                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                 'empty'>,
                                                                '32'),
                                                         <'32', 'exporter', h('empty')>, '32'), 
                                                  pk(~ltk)>)
                                              >,
                                              ~ltk)
                                        >, 
                                        '20', 
                                        hmac(<
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_serverauthenticatorfinishedkey', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              Expand(Expand(Expand(~n,
                                                                   <'32', 
                                                                    'TLS13exportermastersecret', 
                                                                    h(~n.1)>,
                                                                   '32'),
                                                            <'32', 
                                                             'EXPORTER_serverauthenticatorhandshakecontext', 
                                                             'empty'>,
                                                            '32'),
                                                     <'32', 'exporter', h('empty')>, '32'), 
                                              <'11', pk(~ltk)>, '15', 
                                              sign(<'ExportedAuthenticator', 
                                                    h(<
                                                       Expand(Expand(Expand(~n,
                                                                            <'32', 
                                                                             'TLS13exportermastersecret', 
                                                                             h(~n.1)>,
                                                                            '32'),
                                                                     <'32', 
                                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                      'empty'>,
                                                                     '32'),
                                                              <'32', 'exporter', h('empty')>,
                                                              '32'), 
                                                       pk(~ltk)>)
                                                   >,
                                                   ~ltk)
                                             >)
                                       >
                             ) ▶₀ #vr.11 )
                        case Adv_Send_TLS_target
                        solve( !KU( ~n ) @ #vk.1 )
                          case Reveal_ms
                          by contradiction /* from formulas */
                        qed
                      next
                        case S_Send_Spontaneous
                        by contradiction /* from formulas */
                      qed
                    qed
                  qed
                qed
              next
                case S_Recv
                solve( !Exporters( ~n, 'server', ~sid.1, hccc, hccs, fmc, fms
                       ) ▶₃ #k )
                  case Create_TLS_channel
                  by contradiction /* from formulas */
                qed
              qed
            qed
          qed
        qed
      qed
    qed
  qed
next
  case case_2
  by contradiction /* from formulas */
qed

lemma compound_auth:
  all-traces
  "∀ actor actor2 ms role role2 del ltkD del2 ltkD2 peer peer2 #i #j.
    (((Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #i) ∧
      (Recv( actor2, peer2, ms, role2, <del2, pk(ltkD2)> ) @ #j)) ∧
     (#i < #j)) ⇒
    ((∃ role3 role4 #d #e.
       (((((Owns( peer, ms, role3, <del, ltkD> ) @ #d) ∧
           (¬(role = role3))) ∧
          (#d < #i)) ∧
         (Owns( peer2, ms, role4, <del2, ltkD2> ) @ #e)) ∧
        (¬(role2 = role4))) ∧
       (#e < #j)) ∨
     (∃ actor3 peer3 #f #h.
       (((Revms( ms, actor3, peer3 ) @ #f) ∧ (#f < #j)) ∧
        (RevLtk( ltkD2, del2 ) @ #h)) ∧
       (#h < #j)))"
/*
guarded formula characterizing all counter-examples:
"∃ actor actor2 ms role role2 del ltkD del2 ltkD2 peer peer2 #i #j.
  (Recv( actor, peer, ms, role, <del, pk(ltkD)> ) @ #i) ∧
  (Recv( actor2, peer2, ms, role2, <del2, pk(ltkD2)> ) @ #j)
 ∧
  (#i < #j) ∧
  (∀ role3 role4 #d #e.
    (Owns( peer, ms, role3, <del, ltkD> ) @ #d) ∧
    (Owns( peer2, ms, role4, <del2, ltkD2> ) @ #e)
   ⇒
    ((role = role3) ∨ (¬(#d < #i)) ∨ (role2 = role4) ∨ (¬(#e < #j)))) ∧
  (∀ actor3 peer3 #f #h.
    (Revms( ms, actor3, peer3 ) @ #f) ∧ (RevLtk( ltkD2, del2 ) @ #h)
   ⇒
    ((¬(#f < #j)) ∨ (¬(#h < #j))))"
*/
simplify
solve( Recv( actor2, peer2, ms, role2, <del2, pk(ltkD2)> ) @ #j )
  case C_Recv
  by sorry /* removed */
next
  case C_Recv_Spontaneous
  solve( !Pk( $A, pk(ltkD2) ) ▶₃ #j )
    case Register_pk
    solve( !Exporters( ms, 'client', ~cid, hccc, hccs, fmc, fms
           ) ▶₂ #j )
      case Create_TLS_channel_case_1
      solve( TLS_Recv( ~cid, $S, $C,
                       <<'11', pk(~ltk)>, 
                        <'15', 
                         sign(<'ExportedAuthenticator', 
                               h(<
                                  Expand(Expand(Expand(~n,
                                                       <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                       '32'),
                                                <'32', 
                                                 'EXPORTER_serverauthenticatorhandshakecontext', 
                                                 'empty'>,
                                                '32'),
                                         <'32', 'exporter', h('empty')>, '32'), 
                                  pk(~ltk)>)
                              >,
                              ~ltk)
                        >, 
                        '20', 
                        hmac(<
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              Expand(Expand(Expand(~n,
                                                   <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                   '32'),
                                            <'32', 'EXPORTER_serverauthenticatorhandshakecontext', 
                                             'empty'>,
                                            '32'),
                                     <'32', 'exporter', h('empty')>, '32'), 
                              <'11', pk(~ltk)>, '15', 
                              sign(<'ExportedAuthenticator', 
                                    h(<
                                       Expand(Expand(Expand(~n,
                                                            <'32', 'TLS13exportermastersecret', 
                                                             h(~n.1)>,
                                                            '32'),
                                                     <'32', 
                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                      'empty'>,
                                                     '32'),
                                              <'32', 'exporter', h('empty')>, '32'), 
                                       pk(~ltk)>)
                                   >,
                                   ~ltk)
                             >)
                       >
             ) ▶₁ #j )
        case Send_TLS_Channel_target
        solve( TLS_Send( msg_id, ~sid, $S, $C,
                         <<'11', pk(~ltk)>, 
                          <'15', 
                           sign(<'ExportedAuthenticator', 
                                 h(<
                                    Expand(Expand(Expand(~n,
                                                         <'32', 'TLS13exportermastersecret', h(~n.1)
                                                         >,
                                                         '32'),
                                                  <'32', 
                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                   'empty'>,
                                                  '32'),
                                           <'32', 'exporter', h('empty')>, '32'), 
                                    pk(~ltk)>)
                                >,
                                ~ltk)
                          >, 
                          '20', 
                          hmac(<
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 'EXPORTER_serverauthenticatorfinishedkey', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                Expand(Expand(Expand(~n,
                                                     <'32', 'TLS13exportermastersecret', h(~n.1)>,
                                                     '32'),
                                              <'32', 
                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                               'empty'>,
                                              '32'),
                                       <'32', 'exporter', h('empty')>, '32'), 
                                <'11', pk(~ltk)>, '15', 
                                sign(<'ExportedAuthenticator', 
                                      h(<
                                         Expand(Expand(Expand(~n,
                                                              <'32', 'TLS13exportermastersecret', 
                                                               h(~n.1)>,
                                                              '32'),
                                                       <'32', 
                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                        'empty'>,
                                                       '32'),
                                                <'32', 'exporter', h('empty')>, '32'), 
                                         pk(~ltk)>)
                                     >,
                                     ~ltk)
                               >)
                         >
               ) ▶₀ #vr.5 )
          case Adv_Send_TLS_target
          by sorry
        next
          case S_Send_Spontaneous
          solve( Recv( actor, peer, ~n, role, <del, pk(ltkD)> ) @ #i )
            case C_Recv
            by sorry
          next
            case C_Recv_Spontaneous
            solve( !Exporters( ~n, 'client', ~cid, hccc, hccs, fmc, fms
                   ) ▶₂ #i )
              case Create_TLS_channel
              solve( TLS_Recv( ~cid, $S, $C,
                               <<'11', pk(ltkD)>, 
                                <'15', 
                                 sign(<'ExportedAuthenticator', 
                                       h(<
                                          Expand(Expand(Expand(~n,
                                                               <'32', 'TLS13exportermastersecret', 
                                                                h(~n.1)>,
                                                               '32'),
                                                        <'32', 
                                                         'EXPORTER_serverauthenticatorhandshakecontext', 
                                                         'empty'>,
                                                        '32'),
                                                 <'32', 'exporter', h('empty')>, '32'), 
                                          pk(ltkD)>)
                                      >,
                                      ltkD)
                                >, 
                                '20', 
                                hmac(<
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorfinishedkey', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      Expand(Expand(Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32'),
                                                    <'32', 
                                                     'EXPORTER_serverauthenticatorhandshakecontext', 
                                                     'empty'>,
                                                    '32'),
                                             <'32', 'exporter', h('empty')>, '32'), 
                                      <'11', pk(ltkD)>, '15', 
                                      sign(<'ExportedAuthenticator', 
                                            h(<
                                               Expand(Expand(Expand(~n,
                                                                    <'32', 
                                                                     'TLS13exportermastersecret', 
                                                                     h(~n.1)>,
                                                                    '32'),
                                                             <'32', 
                                                              'EXPORTER_serverauthenticatorhandshakecontext', 
                                                              'empty'>,
                                                             '32'),
                                                      <'32', 'exporter', h('empty')>, '32'), 
                                               pk(ltkD)>)
                                           >,
                                           ltkD)
                                     >)
                               >
                     ) ▶₁ #i )
                case Send_TLS_Channel_target
                solve( TLS_Send( msg_id.1, ~sid, $S, $C,
                                 <<'11', pk(ltkD)>, 
                                  <'15', 
                                   sign(<'ExportedAuthenticator', 
                                         h(<
                                            Expand(Expand(Expand(~n,
                                                                 <'32', 
                                                                  'TLS13exportermastersecret', 
                                                                  h(~n.1)>,
                                                                 '32'),
                                                          <'32', 
                                                           'EXPORTER_serverauthenticatorhandshakecontext', 
                                                           'empty'>,
                                                          '32'),
                                                   <'32', 'exporter', h('empty')>, '32'), 
                                            pk(ltkD)>)
                                        >,
                                        ltkD)
                                  >, 
                                  '20', 
                                  hmac(<
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorfinishedkey', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        Expand(Expand(Expand(~n,
                                                             <'32', 'TLS13exportermastersecret', 
                                                              h(~n.1)>,
                                                             '32'),
                                                      <'32', 
                                                       'EXPORTER_serverauthenticatorhandshakecontext', 
                                                       'empty'>,
                                                      '32'),
                                               <'32', 'exporter', h('empty')>, '32'), 
                                        <'11', pk(ltkD)>, '15', 
                                        sign(<'ExportedAuthenticator', 
                                              h(<
                                                 Expand(Expand(Expand(~n,
                                                                      <'32', 
                                                                       'TLS13exportermastersecret', 
                                                                       h(~n.1)>,
                                                                      '32'),
                                                               <'32', 
                                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                'empty'>,
                                                               '32'),
                                                        <'32', 'exporter', h('empty')>, '32'), 
                                                 pk(ltkD)>)
                                             >,
                                             ltkD)
                                       >)
                                 >
                       ) ▶₀ #vr.7 )
                  case Adv_Send_TLS_target
                  solve( !KU( ~n ) @ #vk.1 )
                    case Reveal_ms
                    solve( !Pk( $A, pk(ltkD) ) ▶₃ #i )
                      case Register_pk
                      solve( !KU( sign(<'ExportedAuthenticator', 
                                        h(<
                                           Expand(Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32'),
                                                  <'32', 'exporter', h('empty')>, '32'), 
                                           pk(~ltk)>)
                                       >,
                                       ~ltk)
                             ) @ #vk.9 )
                        case Adv_Recv_TLS_target
                        by contradiction /* from formulas */
                      next
                        case c_sign
                        solve( !KU( ~ltk ) @ #vk.14 )
                          case Reveal_ltk
                          solve( Start( ~cid, $C, $S, 'client' ) @ #j.1 )
                            case C_1_uni
                            solve( PreStart( ~cid, $C, $S, 'client' ) @ #j.2 )
                              case C_0
                              solve( PreStart( ~sid, $S, $C, 'server' ) @ #vr.3 )
                                case S_0
                                solve( Start( ~sid, $S, $C, 'server' ) @ #vr.2 )
                                  case S_1_uni
                                  solve( !KU( h(<
                                                 Expand(Expand(Expand(~n,
                                                                      <'32', 
                                                                       'TLS13exportermastersecret', 
                                                                       h(~n.1)>,
                                                                      '32'),
                                                               <'32', 
                                                                'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                'empty'>,
                                                               '32'),
                                                        <'32', 'exporter', h('empty')>, '32'), 
                                                 pk(~ltk)>)
                                         ) @ #vk.16 )
                                    case c_h
                                    solve( !KU( Expand(Expand(Expand(~n,
                                                                     <'32', 
                                                                      'TLS13exportermastersecret', 
                                                                      h(~n.1)>,
                                                                     '32'),
                                                              <'32', 
                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                               'empty'>,
                                                              '32'),
                                                       <'32', 'exporter', h('empty')>, '32')
                                           ) @ #vk.18 )
                                      case c_Expand
                                      solve( !KU( Expand(Expand(~n,
                                                                <'32', 'TLS13exportermastersecret', 
                                                                 h(~n.1)>,
                                                                '32'),
                                                         <'32', 
                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                          'empty'>,
                                                         '32')
                                             ) @ #j.4 )
                                        case c_Expand
                                        solve( !KU( Expand(~n,
                                                           <'32', 'TLS13exportermastersecret', 
                                                            h(~n.1)>,
                                                           '32')
                                               ) @ #j.4 )
                                          case c_Expand
                                          solve( !KU( h(~n.1) ) @ #vk.31 )
                                            case c_h
                                            solve( !KU( pk(~ltk) ) @ #vk.14 )
                                              case Adv_Recv_TLS_owner_case_1
                                              by sorry
                                            next
                                              case Adv_Recv_TLS_owner_case_2
                                              by sorry
                                            next
                                              case Adv_Recv_TLS_target_case_1
                                              by sorry
                                            next
                                              case Adv_Recv_TLS_target_case_2
                                              by sorry
                                            next
                                              case Adv_Recv_TLS_target_case_3
                                              by sorry
                                            next
                                              case Adv_Recv_TLS_target_case_4
                                              by sorry
                                            next
                                              case Get_pk
                                              solve( !KU( hmac(<
                                                                Expand(Expand(Expand(~n,
                                                                                     <'32', 
                                                                                      'TLS13exportermastersecret', 
                                                                                      h(~n.1)>,
                                                                                     '32'),
                                                                              <'32', 
                                                                               'EXPORTER_serverauthenticatorfinishedkey', 
                                                                               'empty'>,
                                                                              '32'),
                                                                       <'32', 'exporter', h('empty')
                                                                       >,
                                                                       '32'), 
                                                                Expand(Expand(Expand(~n,
                                                                                     <'32', 
                                                                                      'TLS13exportermastersecret', 
                                                                                      h(~n.1)>,
                                                                                     '32'),
                                                                              <'32', 
                                                                               'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                               'empty'>,
                                                                              '32'),
                                                                       <'32', 'exporter', h('empty')
                                                                       >,
                                                                       '32'), 
                                                                <'11', pk(~ltk)>, '15', 
                                                                sign(<'ExportedAuthenticator', 
                                                                      h(<
                                                                         Expand(Expand(Expand(~n,
                                                                                              <
                                                                                               '32', 
                                                                                               'TLS13exportermastersecret', 
                                                                                               h(~n.1)
                                                                                              >,
                                                                                              '32'),
                                                                                       <'32', 
                                                                                        'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                        'empty'>,
                                                                                       '32'),
                                                                                <'32', 'exporter', 
                                                                                 h('empty')>,
                                                                                '32'), 
                                                                         pk(~ltk)>)
                                                                     >,
                                                                     ~ltk)
                                                               >)
                                                     ) @ #vk.19 )
                                                case Adv_Recv_TLS_target
                                                by contradiction /* from formulas */
                                              next
                                                case c_hmac
                                                solve( !KU( Expand(Expand(Expand(~n,
                                                                                 <'32', 
                                                                                  'TLS13exportermastersecret', 
                                                                                  h(~n.1)>,
                                                                                 '32'),
                                                                          <'32', 
                                                                           'EXPORTER_serverauthenticatorfinishedkey', 
                                                                           'empty'>,
                                                                          '32'),
                                                                   <'32', 'exporter', h('empty')>,
                                                                   '32')
                                                       ) @ #vk.36 )
                                                  case c_Expand
                                                  solve( !KU( Expand(Expand(~n,
                                                                            <'32', 
                                                                             'TLS13exportermastersecret', 
                                                                             h(~n.1)>,
                                                                            '32'),
                                                                     <'32', 
                                                                      'EXPORTER_serverauthenticatorfinishedkey', 
                                                                      'empty'>,
                                                                     '32')
                                                         ) @ #j.5 )
                                                    case c_Expand
                                                    solve( !KU( h('empty') ) @ #vk.32 )
                                                      case c_h
                                                      solve( !KU( ~n.1 ) @ #vk.38 )
                                                        case Reveal_ms
                                                        solve( State( ~cid, 'C1', $C, $S, 'client',
                                                                      auth_status.1
                                                               ) ▶₀ #j )
                                                          case C_1_uni
                                                          by contradiction
                                                             /* non-injective facts (#j.1,#i,#j) */
                                                        next
                                                          case C_Recv
                                                          by sorry
                                                        next
                                                          case C_RecvReq
                                                          by sorry
                                                        next
                                                          case C_Recv_Spontaneous
                                                          solve( State( ~cid, 'C1', $C, $S,
                                                                        'client', auth_status.1
                                                                 ) ▶₀ #vr.16 )
                                                            case C_1_uni
                                                            solve( State( ~cid, 'C1', $C, $S,
                                                                          'client', auth_status
                                                                   ) ▶₀ #i )
                                                              case C_1_uni
                                                              solve( State( ~sid, 'S1', $S, $C,
                                                                            'server', auth_status
                                                                     ) ▶₀ #vr.6 )
                                                                case S_1_uni
                                                                solve( (∃ role2 #h.
                                                                         (Owns( $S, ~n, role2,
                                                                                <$A, ~ltk>
                                                                          ) @ #h)
                                                                        ∧
                                                                         (#h < #i) ∧
                                                                         (¬('client' = role2)))  ∥
                                                                       ((∃ #i.1.
                                                                          (RevLtk( ~ltk, $A
                                                                           ) @ #i.1)
                                                                         ∧
                                                                          #i.1 < #i) ∧
                                                                        (∃ #j.
                                                                          (Revms( ~n, $C, $S ) @ #j)
                                                                         ∧
                                                                          #j < #i)) )
                                                                  case case_1
                                                                  by contradiction
                                                                     /* from formulas */
                                                                next
                                                                  case case_2
                                                                  solve( (∃ role2 #h.
                                                                           (Owns( $S, ~n, role2,
                                                                                  <$A.1, ~ltk.1>
                                                                            ) @ #h)
                                                                          ∧
                                                                           (#h < #j) ∧
                                                                           (¬('client' = role2)))  ∥
                                                                         ((∃ #i.
                                                                            (RevLtk( ~ltk.1, $A.1
                                                                             ) @ #i)
                                                                           ∧
                                                                            #i < #j) ∧
                                                                          (∃ #j.1.
                                                                            (Revms( ~n, $C, $S
                                                                             ) @ #j.1)
                                                                           ∧
                                                                            #j.1 < #j)) )
                                                                    case case_1
                                                                    solve( !Ltk( $A, ~ltk
                                                                           ) ▶₀ #i.1 )
                                                                      case Register_pk
                                                                      solve( Revms( ~n, $C, $S
                                                                             ) @ #j.6 )
                                                                        case Reveal_ms_case_1
                                                                        solve( !TLS_Channel( ~n,
                                                                                             TLS_transcript,
                                                                                             status,
                                                                                             $C, nc,
                                                                                             $S, ns
                                                                               ) ▶₀ #j.6 )
                                                                          case Create_TLS_channel
                                                                          solve( Owns( $S, ~n,
                                                                                       role2,
                                                                                       <$A.1, ~ltk.1
                                                                                       >
                                                                                 ) @ #h )
                                                                            case C_Send
                                                                            by contradiction
                                                                               /* from formulas */
                                                                          next
                                                                            case S_Send
                                                                            by sorry
                                                                          next
                                                                            case S_Send_Spontaneous
                                                                            solve( State( ~sid,
                                                                                          'S1', $S,
                                                                                          $C,
                                                                                          'server',
                                                                                          auth_status
                                                                                   ) ▶₀ #h )
                                                                              case S_1_bi
                                                                              by sorry
                                                                            next
                                                                              case S_1_uni
                                                                              solve( !Exporters( ~n,
                                                                                                 'server',
                                                                                                 ~sid,
                                                                                                 hccc,
                                                                                                 hccs,
                                                                                                 fmc,
                                                                                                 fms
                                                                                     ) ▶₁ #h )
                                                                                case Create_TLS_channel
                                                                                solve( (∃ #i.
                                                                                         (TLS_Sent( ~n,
                                                                                                    <
                                                                                                     <
                                                                                                      '11', 
                                                                                                      pk(~ltk)
                                                                                                     >, 
                                                                                                     <
                                                                                                      '15', 
                                                                                                      sign(<
                                                                                                            'ExportedAuthenticator', 
                                                                                                            h(<
                                                                                                               Expand(Expand(Expand(~n,
                                                                                                                                    <
                                                                                                                                     '32', 
                                                                                                                                     'TLS13exportermastersecret', 
                                                                                                                                     h(~n.1)
                                                                                                                                    >,
                                                                                                                                    '32'),
                                                                                                                             <
                                                                                                                              '32', 
                                                                                                                              'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                              'empty'
                                                                                                                             >,
                                                                                                                             '32'),
                                                                                                                      <
                                                                                                                       '32', 
                                                                                                                       'exporter', 
                                                                                                                       h('empty')
                                                                                                                      >,
                                                                                                                      '32'), 
                                                                                                               pk(~ltk)
                                                                                                              >)
                                                                                                           >,
                                                                                                           ~ltk)
                                                                                                     >, 
                                                                                                     '20', 
                                                                                                     hmac(<
                                                                                                           Expand(Expand(Expand(~n,
                                                                                                                                <
                                                                                                                                 '32', 
                                                                                                                                 'TLS13exportermastersecret', 
                                                                                                                                 h(~n.1)
                                                                                                                                >,
                                                                                                                                '32'),
                                                                                                                         <
                                                                                                                          '32', 
                                                                                                                          'EXPORTER_serverauthenticatorfinishedkey', 
                                                                                                                          'empty'
                                                                                                                         >,
                                                                                                                         '32'),
                                                                                                                  <
                                                                                                                   '32', 
                                                                                                                   'exporter', 
                                                                                                                   h('empty')
                                                                                                                  >,
                                                                                                                  '32'), 
                                                                                                           Expand(Expand(Expand(~n,
                                                                                                                                <
                                                                                                                                 '32', 
                                                                                                                                 'TLS13exportermastersecret', 
                                                                                                                                 h(~n.1)
                                                                                                                                >,
                                                                                                                                '32'),
                                                                                                                         <
                                                                                                                          '32', 
                                                                                                                          'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                          'empty'
                                                                                                                         >,
                                                                                                                         '32'),
                                                                                                                  <
                                                                                                                   '32', 
                                                                                                                   'exporter', 
                                                                                                                   h('empty')
                                                                                                                  >,
                                                                                                                  '32'), 
                                                                                                           <
                                                                                                            '11', 
                                                                                                            pk(~ltk)
                                                                                                           >, 
                                                                                                           '15', 
                                                                                                           sign(<
                                                                                                                 'ExportedAuthenticator', 
                                                                                                                 h(<
                                                                                                                    Expand(Expand(Expand(~n,
                                                                                                                                         <
                                                                                                                                          '32', 
                                                                                                                                          'TLS13exportermastersecret', 
                                                                                                                                          h(~n.1)
                                                                                                                                         >,
                                                                                                                                         '32'),
                                                                                                                                  <
                                                                                                                                   '32', 
                                                                                                                                   'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                                   'empty'
                                                                                                                                  >,
                                                                                                                                  '32'),
                                                                                                                           <
                                                                                                                            '32', 
                                                                                                                            'exporter', 
                                                                                                                            h('empty')
                                                                                                                           >,
                                                                                                                           '32'), 
                                                                                                                    pk(~ltk)
                                                                                                                   >)
                                                                                                                >,
                                                                                                                ~ltk)
                                                                                                          >)
                                                                                                    >
                                                                                          ) @ #i)
                                                                                        ∧
                                                                                         #i < #j)  ∥
                                                                                       (∃ #j.1.
                                                                                         (Revms( ~n,
                                                                                                 $C,
                                                                                                 $S
                                                                                          ) @ #j.1)
                                                                                        ∧
                                                                                         #j.1 < #j) )
                                                                                  case case_1
                                                                                  solve( TLS_Sent( ~n,
                                                                                                   <
                                                                                                    <
                                                                                                     '11', 
                                                                                                     pk(~ltk)
                                                                                                    >, 
                                                                                                    <
                                                                                                     '15', 
                                                                                                     sign(<
                                                                                                           'ExportedAuthenticator', 
                                                                                                           h(<
                                                                                                              Expand(Expand(Expand(~n,
                                                                                                                                   <
                                                                                                                                    '32', 
                                                                                                                                    'TLS13exportermastersecret', 
                                                                                                                                    h(~n.1)
                                                                                                                                   >,
                                                                                                                                   '32'),
                                                                                                                            <
                                                                                                                             '32', 
                                                                                                                             'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                             'empty'
                                                                                                                            >,
                                                                                                                            '32'),
                                                                                                                     <
                                                                                                                      '32', 
                                                                                                                      'exporter', 
                                                                                                                      h('empty')
                                                                                                                     >,
                                                                                                                     '32'), 
                                                                                                              pk(~ltk)
                                                                                                             >)
                                                                                                          >,
                                                                                                          ~ltk)
                                                                                                    >, 
                                                                                                    '20', 
                                                                                                    hmac(<
                                                                                                          Expand(Expand(Expand(~n,
                                                                                                                               <
                                                                                                                                '32', 
                                                                                                                                'TLS13exportermastersecret', 
                                                                                                                                h(~n.1)
                                                                                                                               >,
                                                                                                                               '32'),
                                                                                                                        <
                                                                                                                         '32', 
                                                                                                                         'EXPORTER_serverauthenticatorfinishedkey', 
                                                                                                                         'empty'
                                                                                                                        >,
                                                                                                                        '32'),
                                                                                                                 <
                                                                                                                  '32', 
                                                                                                                  'exporter', 
                                                                                                                  h('empty')
                                                                                                                 >,
                                                                                                                 '32'), 
                                                                                                          Expand(Expand(Expand(~n,
                                                                                                                               <
                                                                                                                                '32', 
                                                                                                                                'TLS13exportermastersecret', 
                                                                                                                                h(~n.1)
                                                                                                                               >,
                                                                                                                               '32'),
                                                                                                                        <
                                                                                                                         '32', 
                                                                                                                         'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                         'empty'
                                                                                                                        >,
                                                                                                                        '32'),
                                                                                                                 <
                                                                                                                  '32', 
                                                                                                                  'exporter', 
                                                                                                                  h('empty')
                                                                                                                 >,
                                                                                                                 '32'), 
                                                                                                          <
                                                                                                           '11', 
                                                                                                           pk(~ltk)
                                                                                                          >, 
                                                                                                          '15', 
                                                                                                          sign(<
                                                                                                                'ExportedAuthenticator', 
                                                                                                                h(<
                                                                                                                   Expand(Expand(Expand(~n,
                                                                                                                                        <
                                                                                                                                         '32', 
                                                                                                                                         'TLS13exportermastersecret', 
                                                                                                                                         h(~n.1)
                                                                                                                                        >,
                                                                                                                                        '32'),
                                                                                                                                 <
                                                                                                                                  '32', 
                                                                                                                                  'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                                  'empty'
                                                                                                                                 >,
                                                                                                                                 '32'),
                                                                                                                          <
                                                                                                                           '32', 
                                                                                                                           'exporter', 
                                                                                                                           h('empty')
                                                                                                                          >,
                                                                                                                          '32'), 
                                                                                                                   pk(~ltk)
                                                                                                                  >)
                                                                                                               >,
                                                                                                               ~ltk)
                                                                                                         >)
                                                                                                   >
                                                                                         ) @ #i.2 )
                                                                                    case S_Send_Spontaneous
                                                                                    solve( !Exporters( ~n,
                                                                                                       'server',
                                                                                                       ~sid.1,
                                                                                                       hccc,
                                                                                                       Expand(Expand(Expand(~n,
                                                                                                                            <
                                                                                                                             '32', 
                                                                                                                             'TLS13exportermastersecret', 
                                                                                                                             h(~n.1)
                                                                                                                            >,
                                                                                                                            '32'),
                                                                                                                     <
                                                                                                                      '32', 
                                                                                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                      'empty'
                                                                                                                     >,
                                                                                                                     '32'),
                                                                                                              <
                                                                                                               '32', 
                                                                                                               'exporter', 
                                                                                                               h('empty')
                                                                                                              >,
                                                                                                              '32'),
                                                                                                       fmc,
                                                                                                       Expand(Expand(Expand(~n,
                                                                                                                            <
                                                                                                                             '32', 
                                                                                                                             'TLS13exportermastersecret', 
                                                                                                                             h(~n.1)
                                                                                                                            >,
                                                                                                                            '32'),
                                                                                                                     <
                                                                                                                      '32', 
                                                                                                                      'EXPORTER_serverauthenticatorfinishedkey', 
                                                                                                                      'empty'
                                                                                                                     >,
                                                                                                                     '32'),
                                                                                                              <
                                                                                                               '32', 
                                                                                                               'exporter', 
                                                                                                               h('empty')
                                                                                                              >,
                                                                                                              '32')
                                                                                           ) ▶₁ #i.2 )
                                                                                      case Create_TLS_channel
                                                                                      solve( State( ~sid,
                                                                                                    'S1',
                                                                                                    $S,
                                                                                                    $C,
                                                                                                    'server',
                                                                                                    auth_status
                                                                                             ) ▶₀ #i.2 )
                                                                                        case S_1_uni
                                                                                        solve( (∃ #i.1.
                                                                                                 (TLS_Sent( ~n,
                                                                                                            <
                                                                                                             <
                                                                                                              '11', 
                                                                                                              pk(~ltk.1)
                                                                                                             >, 
                                                                                                             <
                                                                                                              '15', 
                                                                                                              sign(<
                                                                                                                    'ExportedAuthenticator', 
                                                                                                                    h(<
                                                                                                                       Expand(Expand(Expand(~n,
                                                                                                                                            <
                                                                                                                                             '32', 
                                                                                                                                             'TLS13exportermastersecret', 
                                                                                                                                             h(~n.1)
                                                                                                                                            >,
                                                                                                                                            '32'),
                                                                                                                                     <
                                                                                                                                      '32', 
                                                                                                                                      'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                                      'empty'
                                                                                                                                     >,
                                                                                                                                     '32'),
                                                                                                                              <
                                                                                                                               '32', 
                                                                                                                               'exporter', 
                                                                                                                               h('empty')
                                                                                                                              >,
                                                                                                                              '32'), 
                                                                                                                       pk(~ltk.1)
                                                                                                                      >)
                                                                                                                   >,
                                                                                                                   ~ltk.1)
                                                                                                             >, 
                                                                                                             '20', 
                                                                                                             hmac(<
                                                                                                                   Expand(Expand(Expand(~n,
                                                                                                                                        <
                                                                                                                                         '32', 
                                                                                                                                         'TLS13exportermastersecret', 
                                                                                                                                         h(~n.1)
                                                                                                                                        >,
                                                                                                                                        '32'),
                                                                                                                                 <
                                                                                                                                  '32', 
                                                                                                                                  'EXPORTER_serverauthenticatorfinishedkey', 
                                                                                                                                  'empty'
                                                                                                                                 >,
                                                                                                                                 '32'),
                                                                                                                          <
                                                                                                                           '32', 
                                                                                                                           'exporter', 
                                                                                                                           h('empty')
                                                                                                                          >,
                                                                                                                          '32'), 
                                                                                                                   Expand(Expand(Expand(~n,
                                                                                                                                        <
                                                                                                                                         '32', 
                                                                                                                                         'TLS13exportermastersecret', 
                                                                                                                                         h(~n.1)
                                                                                                                                        >,
                                                                                                                                        '32'),
                                                                                                                                 <
                                                                                                                                  '32', 
                                                                                                                                  'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                                  'empty'
                                                                                                                                 >,
                                                                                                                                 '32'),
                                                                                                                          <
                                                                                                                           '32', 
                                                                                                                           'exporter', 
                                                                                                                           h('empty')
                                                                                                                          >,
                                                                                                                          '32'), 
                                                                                                                   <
                                                                                                                    '11', 
                                                                                                                    pk(~ltk.1)
                                                                                                                   >, 
                                                                                                                   '15', 
                                                                                                                   sign(<
                                                                                                                         'ExportedAuthenticator', 
                                                                                                                         h(<
                                                                                                                            Expand(Expand(Expand(~n,
                                                                                                                                                 <
                                                                                                                                                  '32', 
                                                                                                                                                  'TLS13exportermastersecret', 
                                                                                                                                                  h(~n.1)
                                                                                                                                                 >,
                                                                                                                                                 '32'),
                                                                                                                                          <
                                                                                                                                           '32', 
                                                                                                                                           'EXPORTER_serverauthenticatorhandshakecontext', 
                                                                                                                                           'empty'
                                                                                                                                          >,
                                                                                                                                          '32'),
                                                                                                                                   <
                                                                                                                                    '32', 
                                                                                                                                    'exporter', 
                                                                                                                                    h('empty')
                                                                                                                                   >,
                                                                                                                                   '32'), 
                                                                                                                            pk(~ltk.1)
                                                                                                                           >)
                                                                                                                        >,
                                                                                                                        ~ltk.1)
                                                                                                                  >)
                                                                                                            >
                                                                                                  ) @ #i.1)
                                                                                                ∧
                                                                                                 #i.1 < #i)  ∥
                                                                                               (∃ #j.
                                                                                                 (Revms( ~n,
                                                                                                         $C,
                                                                                                         $S
                                                                                                  ) @ #j)
                                                                                                ∧
                                                                                                 #j < #i) )
                                                                                          case case_1
                                                                                          by sorry
                                                                                        next
                                                                                          case case_2
                                                                                          SOLVED // trace found
                                                                                        qed
                                                                                      next
                                                                                        case S_Recv
                                                                                        by sorry
                                                                                      next
                                                                                        case S_RecvReq
                                                                                        by sorry
                                                                                      next
                                                                                        case S_Request
                                                                                        by sorry
                                                                                      next
                                                                                        case S_Send
                                                                                        by sorry
                                                                                      next
                                                                                        case S_Send_Spontaneous
                                                                                        by sorry
                                                                                      qed
                                                                                    qed
                                                                                  qed
                                                                                next
                                                                                  case case_2
                                                                                  by sorry
                                                                                qed
                                                                              qed
                                                                            next
                                                                              case S_RecvReq_case_1
                                                                              by sorry
                                                                            next
                                                                              case S_RecvReq_case_2
                                                                              by sorry
                                                                            next
                                                                              case S_Recv_case_1
                                                                              by sorry
                                                                            next
                                                                              case S_Recv_case_2
                                                                              by sorry
                                                                            next
                                                                              case S_Request_case_1
                                                                              by sorry
                                                                            next
                                                                              case S_Request_case_2
                                                                              by sorry
                                                                            next
                                                                              case S_Send_Spontaneous_case_1
                                                                              by sorry
                                                                            next
                                                                              case S_Send_Spontaneous_case_2
                                                                              by sorry
                                                                            next
                                                                              case S_Send_case_1
                                                                              by sorry
                                                                            next
                                                                              case S_Send_case_2
                                                                              by sorry
                                                                            qed
                                                                          qed
                                                                        qed
                                                                      next
                                                                        case Reveal_ms_case_2
                                                                        by sorry
                                                                      qed
                                                                    qed
                                                                  next
                                                                    case case_2
                                                                    by contradiction
                                                                       /* from formulas */
                                                                  qed
                                                                qed
                                                              next
                                                                case S_Recv
                                                                by sorry
                                                              next
                                                                case S_RecvReq
                                                                by sorry
                                                              next
                                                                case S_Request
                                                                by sorry
                                                              next
                                                                case S_Send
                                                                by sorry
                                                              next
                                                                case S_Send_Spontaneous
                                                                by sorry
                                                              qed
                                                            next
                                                              case C_Recv
                                                              by sorry
                                                            next
                                                              case C_RecvReq
                                                              by sorry
                                                            next
                                                              case C_Recv_Spontaneous
                                                              by sorry
                                                            next
                                                              case C_Request
                                                              by sorry
                                                            next
                                                              case C_Send
                                                              by sorry
                                                            qed
                                                          next
                                                            case C_Recv
                                                            by sorry
                                                          next
                                                            case C_RecvReq
                                                            by sorry
                                                          next
                                                            case C_Recv_Spontaneous
                                                            by sorry
                                                          next
                                                            case C_Request
                                                            by sorry
                                                          next
                                                            case C_Send
                                                            by sorry
                                                          qed
                                                        next
                                                          case C_Request
                                                          by sorry
                                                        next
                                                          case C_Send
                                                          by sorry
                                                        qed
                                                      qed
                                                    qed
                                                  qed
                                                qed
                                              qed
                                            next
                                              case c_pk
                                              by sorry
                                            qed
                                          qed
                                        qed
                                      qed
                                    qed
                                  qed
                                qed
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                next
                  case S_Send_Spontaneous
                  by sorry
                qed
              qed
            qed
          next
            case S_Recv
            by sorry
          qed
        qed
      qed
    next
      case Create_TLS_channel_case_2
      by sorry
    qed
  qed
next
  case S_Recv
  by sorry
qed

/* All well-formedness checks were successful. */

end
